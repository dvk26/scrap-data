
\section{Properties of the dominance}

\PropDomLinked*

\begin{proof}
  We need to show that the intrinsic order on \(\Sigma\) coincides with the path relation. First, we observe that \(\bot   \specle   \top\); indeed, fixing a map \(f :  \Sigma   \to   \Sigma\), by Phoa's principle, evaluation at boundary obtains a pair \((f~ \bot , f~ \top )\) such that \(f~ \bot\) implies \(f~ \top\). In one direction, suppose \(x  \pathle  y\), which means we have a path \(l :  \Sigma   \to   \Sigma\) whose boundary is determined by \(x, y\). Fixing \(f :  \Sigma   \to   \Sigma\), we want to show that \(f~x  \to  f~y\). But this follows by evaluating \(\bot   \specle   \top\) at the $\Sigma$-predicate \(f  \circ  l :  \Sigma   \to   \Sigma\). Conversely, if \(x \specle  y\), then we have in particular \(x  \to  y\), which by Phoa's principle uniquely determines a path \(l :  \Sigma   \to   \Sigma\).
\end{proof}

\section{Properties of predomains}

\PropPredomainProperties*
\begin{proof}
  Replete types are both complete and boundary separated because the latter can be defined by orthogonality conditions and is satisfied by $\Sigma$: it is complete by the axioms of SDT (\cref{def:axioms}) and it is boundary separated by \cref{prop:sigma-boundary-sep}. Assuming Phoa's principle, the proof that replete types are linked can be found in Taylor~\cite[Corollary 2.10]{taylor:1991} and Reus~\cite[Corollary 6.1.16]{reus:1995}. Lastly, one can show that the objects whose link relation is antisymmetric can be defined as an orthogonality condition, thus we know that the link relation on every replete type is antisymmetric, hence it follows the intrinsic order on replete types are also partial orders since they are linked.
\end{proof}

\PropSealingSigDecidable*

\begin{proof}
  We observe that $\P \vee A$ is defined as the pushout of the projections of $A \times \P$ as indicated below: 
  \[
  \DiagramSquare{
      ne = A, 
      se = \P \vee A,
      nw = A \times \P,
      se/style = pushout,
      sw = \P, 
      east = \eta_{\P \vee -}, 
      south = \star,
      }
  \]
  Using the fact that $A$ has $\Sigma$-equality, we obtain a map $f : (\P \vee A) \times (\P \vee A) \to \P \vee \Sigma$ such that $f(\eta_{\P \vee -}(x), \eta_{\P \vee -}(y)) = \eta_{\P \vee -}(x = y)$ and $f(\star, -) = f(-, \star) = \star$. The desired characteristic map can then be defined as $\sigma \circ f$, where $\sigma : \P \vee \Sigma \to \Sigma$ is defined as follows:
  \begin{align*}
    &\sigma : \P \vee \Sigma \to \Sigma\\ 
    &\sigma(\eta_{\P \vee -}(\phi)) = \P \vee \phi\\ 
    &\sigma(\star) = \top
  \end{align*}  
  For any $u, v : \P \vee A$, if $u = v = \eta_{\P \vee -}(x)$ for some $x : A$, then we have $\sigma(f(u, v)) = \sigma(\eta_{\P \vee -}(x = x)) = \P \vee (x = x) = \top$. Otherwise, we have that $u$ or $v$ is $\star$, which means $\P$ holds and so $\sigma(f(u, v)) = \sigma(\star) = \top$ as well. Conversely, suppose $\sigma(f(u, v)) = \top$, and that $u = \eta_{\P \vee -}(x)$ and $v = \eta_{\P \vee -}(y)$, which means that $\sigma(\eta_{\P \vee -}(x = y)) = \P \vee (x = y)$ holds. If $\P$ holds, we are done as $(\P \vee A) \cong 1$ in this case. Otherwise, we have $x = y$, and so $u = \eta_{\P \vee -}(x) = \eta_{\P \vee -}(y) = v$. Lastly, if either $u$ or $v$ is the unique element $\star$ then we may discharge the case as above. 
\end{proof}

\PropFuncPointwise*

\begin{proof}
  This is Proposition 5.4.4 of Phoa~\cite{phoa:1991}. We just show the case for the function types. Given a path $f \le_{X \to B} g$, it is clear that we may construct a path $f~x \le B g~x$ for all $x : X$. Conversely, suppose we are given a path $f~x \le B g~x$ for all $x : X$. By \cref{prop:predomain-properties}, $B$ is boundary separated, and so such paths are necessarily unique, and so we have a function $\alpha : X \to \Sigma \to B$ such that $\alpha(x)$ is a path $f~x \le B g~x$. We then obtain a path $f \le_{X \to B} g$ by taking the exponential transpose of $\alpha$.  
\end{proof}

\PropLiftPointwise*

\begin{proof}
  In the forward direction, we have a path \(x{ \downarrow }\) \(\sqsubseteq\) \(y{ \downarrow }\), which means \(x{ \downarrow }\) implies \(y{ \downarrow }\) as the \(\Sigma\) is linked by \cref{prop:dom-linked}. Suppose \(x { \downarrow }\), and let \(f : A  \to   \Sigma\) be arbitrary. By assumption, we have that \(f'(x)  \to  f'(y)\), where \(f'(( \phi , u)) =  \phi   \mathbin{\angle}  f  \circ  u\). In other words, we have \(x { \downarrow }   \mathbin{\angle}  f(x)\) implies \(y { \downarrow }   \mathbin{\angle}  f(y)\). Since \(x { \downarrow }\) holds, we have that \(f(x)  \to  f(y)\), which by definition means \(x  \sqsubseteq _A y\). 
    
  In the backward direction, let \(\alpha  :  x { \downarrow }   \to  x  \sqsubseteq _A y\) be the given partial path. We may define a total path \(\beta  :  \Sigma   \to   \mathsf{L} A\) between \(x\) and \(y\) by setting $\beta ( \phi ) = ( x { \downarrow } ,  \lambda  p.~ \alpha ~p~ \phi )$. Thus we have $x \le_{\lift{A}} y$ as required.
\end{proof}

\PropLub* 

\begin{proof}
  The final \(\mathsf{L}\)-coalgebra is equipped with a global element \(\infty  :  \overline{\omega}\) that can be thought of as the ``point at infinity''. Define \(f_ \infty\) be the element determined by the unique extension \(\overline{f}  :  \overline{\omega}   \to  A\) evaluated at the invariant point \(\infty\). 
  \begin{enumerate}
    \item First we show that \(f_ \infty\) is an upper bound for \(f\). Fixing \(i:  \omega\), we need to show that \(f~i  \sqsubseteq ^ \circ _A f_ \infty\). Because \(\overline{f}\) extends \(f\), it suffices to show \(\overline{f} ~i  \sqsubseteq ^ \circ _A f_ \infty\). Using the fact that every map is monotone with respect to the specialization order, the result holds because \(i  \sqsubseteq ^ \circ _{ \overline{\omega} }  \infty\).
    
    \item Let \(\alpha\) be an upper bound for \(f\). We need to show that \(f_ \infty   \sqsubseteq ^ \circ   \alpha\). If the principal lower set \({ \downarrow }( \alpha )\) is complete, we have the following lifting situation:
    \[\begin{tikzpicture}[diagram]
      \path
      (-1.5,0) node (I) {$\omega$}
      (1.5,0) node (F) {$\overline{\omega}$}
      (0,-2) node (A) [align=center] {${\downarrow}(\alpha) = \{ a \mid a \specle \alpha \}$};
      \draw[embedding] (I) to (F); 
      \draw[->] (I) to node[left] {$f$} (A); 
      \draw[->,exists] (F) to node[right, shift={(0.1,0)}] {$\tilde{f}$} (A);
      \end{tikzpicture}
      \]
      
      In the above \(\tilde{f}\) is the unique extension of \(f\) considered as a map \(\omega   \to  { \downarrow }( \alpha )\). By uniqueness of \(\overline{f}\) as the extension of \(f :  \omega   \to  A\), \(\tilde{f}\) is equal to \(\overline{f}\) considered as maps \(\overline{\omega}   \to  A\). Consequently we have that \(f_ \infty  =  \overline{f} ( \infty ) =  \tilde{f} ( \infty )\), so the result follows by observing that \(\tilde{f} ( \infty )  \in  { \downarrow }( \alpha )\).
    
      It remains to show that \({ \downarrow }( \alpha )\) is complete. We can express the principal lower set as follows:
      \[\begin{aligned}           { \downarrow }( \alpha ) &=  { \left \{ a  \mid  a  \sqsubseteq ^ \circ   \alpha \right \} } \\  
          &=  { \left \{ a  \mid   \forall  f:A \to \Sigma ~ f(a)  \to  f( \alpha ) \right \} } \\  
          &=  \bigcap _{f:A \to \Sigma }  { \left \{ a  \mid  f(a)  \to  f( \alpha ) \right \} }        \end{aligned}\] 
          
      Because complete types are internally complete, the result would follow if we can show that \(S =  { \left \{ a  \mid  f(a)  \to  f( \alpha ) \right \} }\) is complete. We may show that \(S\) can be computed as follows: 
      \[
      \DiagramSquare{
      ne = A, 
      se = \Sigma \times \Sigma,
      nw = S,
      nw/style = pullback,
      sw = \Sigma^\Sigma,
      east = {\langle f, f(\alpha)\rangle}, 
      south = \partial,
      }
      \]
      Since $S$ can be defined as the limit of a diagram of complete types, it is complete as well. 
\end{enumerate}
\end{proof}

\PropMonotone*

\begin{proof}
  Given $a \le b$, we derive a path $\Sigma \to B$ whose boundary is $(f~a, f~b)$ by postcomposing with $f$, and so $f~a \le f~b$ as well. 
\end{proof}

\PropCont* 

\begin{proof}
  Predomains are complete, so we have the following extensions of $d$ and $f \circ d$: 
  \[
  \begin{tikzpicture}[diagram]
    \SpliceDiagramSquare<sq/>{
    width = 3cm,
    nw = \omega, 
    sw = \overline{\omega},
    ne = A, 
    se = B,
    east = f, 
    south = \overline{f \circ d}, 
    west/style = embedding, 
    south/style = {->,exists},
   } 
   \draw[->,exists] (sq/sw) to node[desc] {$\overline{d}$} (sq/ne);
  \end{tikzpicture}
  \]
  Because extensions along $\omega \hookrightarrow \overline{\omega}$ are unique for complete types, we have $f \circ \overline{d} = \overline{f \circ d}$. But by definition of the synthetic $\omega$-join, this means that $f(\sup d) = f(\overline{d}(\infty)) = \overline{f \circ d}(\infty) = \sup(f \circ d)$. 
\end{proof}

\section{Domains and admissibility}

\begin{proposition}\label{prop:path-implies-intrinsic}
  The path relation need not coincide with the intrinsic order, but a path $\alpha : x \pathle y$ always implies $x \specle y$. 
\end{proposition}

\begin{proof}
  Suppose we have a path \(l :  \Sigma   \to   \Sigma\) whose boundary is determined by \(x, y\). Fixing \(f :  \Sigma   \to   \Sigma\), we want to show that \(f~x  \to  f~y\). But this follows by evaluating \(\bot   \specle   \top\) at the $\Sigma$-predicate \(f  \circ  l :  \Sigma   \to   \Sigma\). 
\end{proof}

\begin{proposition}\label{prop:invariant-top}
The invariant point $\infty$ is the top element of $\overline{\omega}$ with respect to the intrinsic preorder. 
\end{proposition}

\begin{proof}
  Observe that for any $i : \overline{\omega}$ we have a path $\alpha : i \pathle \infty$ defined by $\alpha(\phi, n) = \phi \vee i(n)$. Thus we have $i \specle \infty$ by \cref{prop:path-implies-intrinsic}. 
\end{proof}

\BugAdmissible*

\begin{proof}
  Suppose $S \subseteq A$ is downward closed and closed under synthetic $\omega$-joins. We must complete the following lifting problem: 
  \[
  \Local{\omega}{\overline{\omega}}{S}[f][?]
  \]
  Because $S$ is complete, we have the following extension of $\omega \xrightarrow{f} A \xhookrightarrow{\iota} S$:
  \[
  \begin{tikzpicture}[diagram]
    \SpliceDiagramSquare<sq/>{
      nw = \omega,
      sw = S,
      ne = \overline{\omega},
      south/style = {opacity = 0},
      east/style = {opacity = 0},
      north/style = >->,
      west = f,
    }
    \node[below = of sq/sw] (S) {$A$};
    \draw[->,dotted] (sq/ne) to node[right] {$\overline{\iota f}$} (S);
    \draw[->,dotted] (sq/ne) to node[right] {$?$} (sq/sw);
    \draw[>->] (sq/sw) to node {} (S);
  \end{tikzpicture}
  \]
  Thus it suffices to show that $\overline{\iota f}$ factors through $S$. Fixing $i : \overline{\omega}$, we want to show that $\overline{\iota f}(i) \in S$. By the assumptions on $S$, we have that $\sup (\iota f) = \overline{\iota f}(\infty)$ is in $S$ and that $a \in S$ whenever $a \le \overline{\iota f}(\infty)$. Thus it suffices to show $\overline{\iota f}(i) \le \overline{\iota f}(\infty)$, which follows from \cref{prop:invariant-top}. 
\end{proof}

\begin{proposition}
  The intersection of a family of admissible subsets of a domain is admissible.
\end{proposition}

\begin{proof}
  The least element is contained in the intersection as it is contained in every fiber. Suppose that \(f :  \omega   \to  A\) is a synthetic \(\omega\)-chain such that \(f_i  \in   \bigcap  F\). But since \(f_i  \in  F_j\) for every \(j : J\),  we have \(\bigvee  f  \in  F_j\) as every \(F_j\) is admissible, which means \(\bigvee  f  \in   \bigcap  F\) as well.
\end{proof}

\begin{proposition}
  If \(P, Q\) are \(\Sigma\)-subsets of a domain \(A\), then the exponential subobject \(Q^P\) is an admissible subset of \(A\). 
\end{proposition}

\begin{proof}
  Let \(f_i  \in  Q^P\) for some synthetic \(\omega\)-chain \(f\). Suppose that \(\bigvee  f  \in  P\). We need to show that \(\bigvee  f  \in  Q\). By the universal property of $\bigvee$, we may assume that \(f_i  \in  P\) for some \(i :  \omega\). By assumption, this means that \(f_i  \in  Q\) and thence \(\bigvee  f  \in  Q\) as every \(\Sigma\)-subset is monotone in the synthetic order.
\end{proof}

\section{Properties of the denotational semantics} 

\PropCostAlgLaws*

\begin{proof}
  Routine computation using the distributive law $\tau$ of \(\mathbb{C}   \times  -\) over the lifting monad.
\end{proof}

\section{Properties of the computational semantics}

\PropEvalFunc*

\begin{proof}
  Consider the following subset:  \[\begin{aligned}     P =  { \left \{ \alpha   \mid   \forall   { \left [ e, v, v' \right ]} ~   \alpha (e, v) { \downarrow }   \land   \alpha (e, v') { \downarrow }   \to  v = v' \right \} }    \end{aligned}\]  
  
  We may check that \(P\) is admissible by means of \cref{cor:admissible} and proceed by fixed-point induction. Suppose that \(\alpha   \in  P\) and that \(\Phi _ \mathsf{eval} ( \alpha )(e, v) { \downarrow }\) and \(\Phi _ \mathsf{eval} ( \alpha )(e, v') { \downarrow }\). We need to show that \(v = v'\). We proceed by cases on \(\mathsf{out} (e)\).
  \begin{enumerate}
    \item{If \(e \mapsto  c',e'\), we may deduce that \(\alpha (e',v) { \downarrow }\) and \(\alpha (e',v') { \downarrow }\), so the result follows from the assumption that \(\alpha   \in  P\). }    \item{Otherwise, we have that \(e = v\) and \(e = v'\) by definition of \(\Phi _ \mathsf{eval}\), and so \(v = v'\).} 
  \end{enumerate}
\end{proof}

\PropEvalSeq* 

\begin{proof}
  Consider the following subset of \(\Pi _{A :  \mathsf{tp} }.~ \mathsf{U} \mathsf{F} A   \to   \mathsf{U} \mathsf{F} A   \to   \mathsf{T} (1)\):
  \[\begin{aligned}     P =  { \left \{ \alpha   \mid   \forall   { \left [ e \right ]} ~   \alpha (e, v) { \downarrow }   \land   \mathsf{eval} (g~v,  \mathsf{ret} (w)) { \downarrow }   \to   \mathsf{eval} (e; g,  \mathsf{ret} (w)) =  \alpha (e, v) +  \mathsf{eval} (g~v,  \mathsf{ret} (w)) \right \} }    \end{aligned}\]  \par{It suffices to show that \(\mathsf{eval}   \in  P\). Observing that \(P\) is admissible, we proceed by fixed-point induction. Suppose that \(\alpha   \in  P\), \(\Phi _ \mathsf{eval} ( \alpha )(e, v) { \downarrow }\), and that \(\mathsf{eval} (g~v,  \mathsf{ret} (w)) { \downarrow }\). We need to show that \(\mathsf{eval} (e; g,  \mathsf{ret} (w)) =  \Phi _ \mathsf{eval} ( \alpha )(e, v) +  \mathsf{eval} (g~v,  \mathsf{ret} (w))\). We proceed by cases on \(\mathsf{out} (e)\). }  \begin{enumerate}
    \item{      If \(e  \mapsto  c',e'\), then we compute: 
      \[\begin{aligned}          \mathsf{eval} (e; g,  \mathsf{ret} (w)) &= c'  \boxplus   \mathsf{eval} (e'; g,  \mathsf{ret} (w)) \\         &= c' +  \alpha (e', v) +  \mathsf{eval} (g~v,  \mathsf{ret} (w)) \\         &=  \Phi _ \mathsf{eval} ( \alpha )(e, v) +  \mathsf{eval} (g~v,  \mathsf{ret} (w)) 
       \end{aligned}\]      \par{Where the first equality follows from the assumption that \(\alpha   \in  P\) and the second by the definition of \(\Phi _ \mathsf{eval}\). }    }    \item{Otherwise, we have that \(e~ \mathsf{val}\). Since \(\Phi _ \mathsf{eval} ( \alpha )(e,  \mathsf{ret} (v)) { \downarrow }  =  (e =  \mathsf{ret} (v), 0) { \downarrow }  = (e =  \mathsf{ret} (v))\) holds, we can compute: }    \[\begin{aligned}       \mathsf{eval} (e; g,  \mathsf{ret} (w)) &=  \mathsf{eval} ( \mathsf{ret} (v); g,  \mathsf{ret} (w)) \\      &=  \Phi _ \mathsf{eval} ( \mathsf{eval} )( \mathsf{ret} (v); g,  \mathsf{ret} (w)) \\      &=  \mathsf{eval} (g~v,  \mathsf{ret} (w))     \end{aligned}\]    \par{But this is what we needed to show since \(\Phi _ \mathsf{eval} ( \alpha )(e,  \mathsf{ret} (v)) = 0\). }  
\end{enumerate}
\end{proof}

\PropCompIndSeq* 

\begin{proof}
  Consider the subset \(P  \subseteq   \mathsf{U} \mathsf{F} A   \to   \mathsf{U} \mathsf{F} A   \to   \mathsf{T} (1)\) defined as the intersection of the following subsets:
  \[\begin{aligned}     &Q =  { \left \{ \alpha   \mid   \alpha   \sqsubseteq   \mathsf{eval} \right \} }   \\     &R =  { \left \{ \alpha   \mid   \forall   { \left [ c', e', n \right ]} ~  (e  \mapsto ^n c', e')  \land   { \left ( \alpha (e'; g,  \mathsf{ret} (w)) { \downarrow } \right )}   \to   \varphi (c' +  \alpha (e'; g,  \mathsf{ret} (w))) \right \} }    \end{aligned}\]   It suffices to show that \(\mathsf{eval}   \in  P\). We have that \(P\) is admissible, and we proceed by fixed-point induction. Suppose that \(\alpha   \in  P\). We need to show that \(\Phi _ \mathsf{eval} ( \alpha )  \in  P\), where \(\Phi _ \mathsf{eval}\) is the characteristic functional of \(\mathsf{eval}\) (\cref{subsec:comp-sem}). It's immediate that \(\Phi _ \mathsf{eval} ( \alpha )  \in  Q\). It remains to show that it is also contained in \(R\). So suppose that \(e  \mapsto ^n c', e'\) and \(\Phi _ \mathsf{eval} ( \alpha )(e'; g,  \mathsf{ret} (w)) { \downarrow }\). We want to show that \(\varphi (c' +  \Phi _ \mathsf{eval} ( \alpha )(e'; g,  \mathsf{ret} (w)))\). We proceed by cases on \(\mathsf{out} (e')\).  
   \begin{enumerate}
    \item{If \(\mathsf{out} (e') =  \mathsf{inl}   \cdot   \star\), then we know that \(e' =  \mathsf{ret} (v)\) for some \(v :  \mathsf{U} \mathsf{F} 1\). Stepping the operational semantics, we have that \(\mathsf{ret} (v); g  \mapsto  0, g~v\), and by definition of the computational semantics \(\Phi _ \mathsf{eval} ( \alpha )(e'; g,  \mathsf{ret} (w)) = 0  \boxplus   \alpha (g~v,  \mathsf{ret} (w)) =  \alpha (g~v,  \mathsf{ret} (w))\). Since we assumed \(\alpha   \in  Q  \iff   \alpha   \sqsubseteq   \mathsf{eval}\), we also have \(\mathsf{eval} (g~v,  \mathsf{ret} (w)) { \downarrow }\), and since \(\mathbb{C}\) is discrete we have \(\alpha (g~v,  \mathsf{ret} (w)) =  \mathsf{eval} (g~v,  \mathsf{ret} (w))\). Recalling the premise and the fact that \(\mathsf{eval} (e,  \mathsf{ret} (v)) = c'\), we may conclude that \(\varphi (c' +  \mathsf{eval} (g~v,  \mathsf{ret} (w)))\), which is what we needed to show.}    \item{Otherwise, \(\mathsf{out} (e') =  \mathsf{inr}   \cdot  (c'', e'')\) for some \(e'' :  \mathsf{U} \mathsf{F} 1\), and we have that \(e';g  \mapsto  c'', e'';g\). By definition of the computational semantics, this means that \(\Phi _ \mathsf{eval} ( \alpha )(e'; g,  \mathsf{ret} (w)) = c''  \boxplus   \alpha (e''; g,  \mathsf{ret} (w))\). Since we assumed that \(c''  \boxplus   \alpha (e''; g,  \mathsf{ret} (w)) { \downarrow }\), we can use the laws of the derived algebra (\cref{prop:cost-alg-laws}) to deduce that \(\alpha (e''; g,  \mathsf{ret} (w)) { \downarrow }\) as well, and so by the assumption that \(\alpha   \in  R  \subseteq  P\), we have that \(\varphi (c' + c'' +  \alpha (e'';g,  \mathsf{ret} (w)))\) holds, which is what we needed to show. }  
\end{enumerate} 
\end{proof}

\PropProfAssoc* 

\begin{proof}
  In one direction, we show that \(\mathsf{profile} ((e; g); i) { \downarrow }\) implies \(\mathsf{profile} (e; ( \lambda  v.~g~v; i)) { \downarrow }\) and both denote identical costs. Consider the \(\Sigma\)-predicate \(\varphi\) such that \(\varphi (c)\) if and only if \(\mathsf{profile} (e; ( \lambda  v.~g~v; h)) = c\). Suppose that \(\mathsf{eval} (e; g,  \mathsf{ret} (w)) { \downarrow }\) and \(\mathsf{profile} (i~w) { \downarrow }\). By computational induction on sequencing~\cref{prop:comp-ind-seq}, it suffices to show that \(\mathsf{profile} (e; ( \lambda  v.~g~v; h)) =  \mathsf{eval} (e; g,  \mathsf{ret} (w)) +  \mathsf{profile} (i~w)\). Applying computational induction on \(\mathsf{eval} (e; g,  \mathsf{ret} (w)) { \downarrow }\), we further suppose that \(\mathsf{eval} (e,  \mathsf{ret} (v)) { \downarrow }\) and \(\mathsf{eval} (g~v,  \mathsf{ret} (w)) { \downarrow }\) and aim to show that \(\mathsf{profile} (e; ( \lambda  v.~g~v; h)) =  \mathsf{eval} (e,  \mathsf{ret} (v)) +  \mathsf{eval} (g~v,  \mathsf{ret} (w)) +  \mathsf{profile} (i~w)\). 
  \begin{enumerate}
    \item{We claim that \(\mathsf{profile} (e; ( \lambda  v.~g~v; i)) { \downarrow }\). By the big-step semantics of profiling~\cref{prop:prof-seq}, it suffices to show that \(\mathsf{eval} (e,  \mathsf{ret} (v)) { \downarrow }\) for some \(v\) and \(\mathsf{profile} (g~v; i) { \downarrow }\). The former follows from our assumption; for the latter, it suffices to show that \(\mathsf{eval} (g~v,  \mathsf{ret} (w)) { \downarrow }\) and \(\mathsf{profile} (i~w) { \downarrow }\), both of which follow from assumptions. }    \item{Given that \(\mathsf{profile} (e; ( \lambda  v.~g~v; i)) { \downarrow }\), we may apply computational induction again: supposing that \(\mathsf{eval} (e,  \mathsf{ret} (v')) { \downarrow }\) and \(\mathsf{profile} (g~v; i) { \downarrow }\), we have to show that \(\mathsf{eval} (e,  \mathsf{ret} (v')) +  \mathsf{profile} (g~v; i) =  \mathsf{eval} (e,  \mathsf{ret} (v)) +  \mathsf{eval} (g~v,  \mathsf{ret} (w)) +  \mathsf{profile} (i~w)\), which follows from the uniqueness of evaluation~\cref{prop:eval-func} and big-step semantics of profiling~\cref{prop:prof-seq}. 
    }  
\end{enumerate}  \par{In the other direction, suppose that \(\mathsf{profile} (e; ( \lambda  v.~g~v; i)) { \downarrow }\). It suffices to show that \(\mathsf{profile} ((e; g); i) { \downarrow }\). By computational induction, we may assume that \(\mathsf{eval} (e,  \mathsf{ret} (v)) { \downarrow }\) and \(\mathsf{profile} (g~v; i) { \downarrow }\). Applying computational induction again, we can also assume that \(\mathsf{eval} (g~v,  \mathsf{ret} (w)) { \downarrow }\) and \(\mathsf{profile} (i~w) { \downarrow }\) for some \(w\). By the big-step semantics of profiling~\cref{prop:prof-seq}, it suffices to show that \(\mathsf{eval} (e; g,  \mathsf{ret} (w)) { \downarrow }\) and \(\mathsf{profile} (i~w) { \downarrow }\). The latter is our assumption, and the former follows from the big-step semantics of evaluation~\cref{prop:eval-seq}.}
\end{proof}

\begin{restatable}{proposition}{PropCompIndApp}\label[prop]{prop:comp-ind-app}
  The following is valid: 
  \begin{mathpar}
  \inferrule{
    \all{e} \kw{eval}(f, \lambda e)\supp{} \land \kw{eval}(e[v], \kw{ret}(w))\supp{} \to \varphi(\kw{eval}(f, \lambda e) + \kw{eval}(e[v], \kw{ret}(w)))
  }{
    \kw{eval}(f~v, \kw{ret}(w))\supp{} \to \varphi(\kw{eval}(f~v, \kw{ret}(w)))
  }
  \end{mathpar}
\end{restatable}

\begin{restatable}{proposition}{PropCommAppSeq}\label[prop]{prop:comm-app-seq}
  We have that \(\mathsf{eval} ((e; g)~w, z) =  \mathsf{eval} (e;  \lambda  v.~g~v~w, z)\). 
\end{restatable}

\section{Soundness of the denotational semantics}

\PropSoundStep* 

\begin{proof}
  By induction on the derivation of \(e  \mapsto  c,e'\). 
\end{proof}

\ThmSound* 

\begin{proof}
  Consider the following subset:
  \[\begin{aligned}     P =  { \left \{ \alpha   \mid   \forall   { \left [ e \right ]} ~   \alpha (e, v) { \downarrow }   \to   \llbracket   e   \rrbracket  =  \mathsf{eval} (e, v)  \boxplus   \llbracket   v   \rrbracket \right \} }  
   \end{aligned}\]  \par{Because \(\llbracket   e   \rrbracket  =  \mathsf{eval} (e, v)  \boxplus   \llbracket   v   \rrbracket\) is a \(\Sigma\)-proposition, we see that \(P\) is an admissible subset. Suppose that \(\alpha   \in  P\) and \(\Phi _{ \mathsf{eval} }( \alpha )(e, v) { \downarrow }\). We need to show that \(\llbracket   e   \rrbracket  =  \mathsf{eval} (e, v)  \boxplus   \llbracket   v   \rrbracket\). We proceed by cases on \(\mathsf{out} (e)\).}  \begin{enumerate}
    \item{If \(e  \mapsto  c',e'\), then by the soundness of the one step relation~\cref{prop:sound-step}, it suffices to show that \(c'  \boxplus   \llbracket   e'   \rrbracket  = c'  \boxplus   \mathsf{eval} (e', v)  \boxplus   \llbracket   v   \rrbracket\), which follows from the assumption, noting that \(\Phi _{ \mathsf{eval} }( \alpha )(e, v) { \downarrow }\) implies \(\alpha (e, v) { \downarrow }\).}    \item{Otherwise, we have that \(e = v\), and so the result holds since \(\mathsf{eval} (e, e) = 0\).}  
\end{enumerate}
\end{proof}

\section{Proofs for the computational adequacy property}\label{app:adequacy}

\begin{proposition}\label[prop]{prop:head-exp}
  If \(d  \lhd _X e\) and \(e'  \mapsto  c, e\), then \(c  \boxplus  d  \lhd _X e'\). 
\end{proposition}

\begin{proof}
  By induction on \(X\), using the laws of the cost algebra\cref{prop:cost-alg-laws}. 
\end{proof}

\subsection{Admissibility}

\begin{proposition}\label[prop]{prop:free-adm}
  We have that \(-  \lhd _{ \U{\F{A}} } e\) is an admissible subset of \(\kw{T}(A)\).
\end{proposition}

\begin{proof}
  By \cref{cor:admissible} it suffices to show downward closure and closure under $\bot$ and synthetic $\omega$-joins. 
  \begin{enumerate}
    \item By definition this means to show $f^\sharp(\bot) \le \kw{profile}(e; g)$ for all \(f  \mathrel{(A \Rightarrow \kw{adq})} g\). But this holds since $f^\sharp(\bot) = \bot$ and $\bot$ is the least element of $\kw{T}(A)$.
    \item Let $d$ be a synthetic $\omega$-chain such that $d_i \lhd_{\U{\F{A}}} e$ for all $i : \omega$. We want to show that $\sup d \lhd_{\U{\F{A}}} e$, which is to show that $f^\sharp(\sup d) \le \kw{profile}(e; g)$ for all \(f \mathrel{(A \Rightarrow \kw{adq})}  g\). Since $f^\sharp(\sup d) = \sup(f^\sharp \circ d)$, this means to show $\sup(f^\sharp \circ d) \le \kw{profile}(e; g)$. By the universal property of the synthetic $\omega$-join, it suffices to show $f^\sharp(d_i) \le \kw{profile}(e; g)$ for all $i:\omega$, but this is the assumption.
    \item Fixing $d' \le d \lhd_{\U{\F{A}}} e$, we need to show that $d' \lhd_{\U{\F{A}}} e$. Suppose that \(f \mathrel{(A \Rightarrow \kw{adq})}  g\). We need to show $f^\sharp(d') \le \kw{profile}(e; g)$. By the characterization of the order on lifts \cref{prop:lift-order}, we suppose $f^\sharp(d')\supp$ and show that $\kw{profile}(e; g)\supp$ and that $f^\sharp(d') = \kw{profile}(e; g)$. By assumption we know $d' = \eta_{\mathbb{L}}(a')$ and $f(a') = c$ for some $a : \sem{A}$ and $c : \P \vee \mathbb{C}$. Since $d' \le d$, we know $d' = \eta_{\mathbb{L}}(a)$ for some $a$ such that $a' \le a$. Consequently, we have $c = f(a') \le f(a)$, but since $\P \vee \mathbb{C}$ is discrete (by \cref{sec:den-sem} and the argument in \cref{prop:comp-ind-seq}), we have $f(a) = c = f(a')$. Thus by the assumption that $d \lhd_{\U{\F{A}}} e$, we have $f^{\sharp}(d) = c \le \kw{profile}(e; g)$. Again by the discreteness of $\P \vee \mathbb{C}$ we have that $f^\sharp(d') = f(a') = c = \kw{profile}(e; g)$, as required.
  \end{enumerate}
\end{proof}

\begin{proposition}\label[prop]{prop:sup-func}
  Suprema of synthetic $\omega$-chains in function spaces are computed pointwise.
\end{proposition}

\begin{proposition}\label[prop]{prop:func-adm}
  Given that \(-  \lhd _{ \mathsf{U} X } e\) is admissible for all \(e :  \mathsf{U} X\), we have that \(-  \lhd _{ \mathsf{U} (A  \to  X) } e\) is as well.
\end{proposition}

\begin{proof}
  Again we show downward closure and closure under $\bot$ and $\sup$. 
  \begin{enumerate}
    \item Because \(\bot (a) =  \bot\), we have that \(\bot   \lhd _{ \mathsf{U} (A  \to  X) } e\) by the assumption that $\bot \lhd_{\U{X}} e$ for all $e$. 
    \item Suppose that \(f_i  \lhd _{ \mathsf{U} (A  \to  X) } e\). We need to show that \(\bigvee  f  \lhd _{ \mathsf{U} (A  \to  X) } e\). Suppose that \(a  \lhd _A b\). We need to show that \(( \bigvee  f)~a  \lhd _{ \mathsf{U} X } e~b\). This follows the fact that synthetic \(\omega\)-joins in function spaces are computed pointwise and the assumption that \(-  \lhd _{ \mathsf{U} X } e~b\) is closed under $\sup$. 
    \item Fix $f' \le f \lhd_{\U{(A \to X)}} e$. To show that $f' \lhd_{\U{(A \to X)}} e$, suppose that $a \lhd_A b$. We need to show that $f'~a \lhd_{\U{X}} e~b$. By the premise, we have that \(-  \lhd _{ \mathsf{U} X } e~b\) is a lower set, so it suffices to show $f'~a \le f~a \lhd_{\U{X}} e~b$, which follow from the assumptions $f' \le f$ and $f \lhd_{\U{(A \to X)}} e$. 
  \end{enumerate} 
\end{proof}

\begin{proposition}\label[prop]{prop:formal-adm}
  Given \(e :  \U{X}\), we have that \(-  \lhd _{ \U{X} } e\) is an admissible subset of \(\sem{\U{X}}\). 
\end{proposition}

\begin{proof}
 By \cref{prop:free-adm,prop:func-adm}.  
\end{proof}

\subsection{Fundamental lemma}

We give the representative cases of the proof by induction on the derivation of terms. 

\begin{lemma}\label[lem]{lem:fllr-ret}
  If \(a  \lhd _A v\), then \(\eta _ \mathsf{T} (a)  \lhd _{ \mathsf{U} \mathsf{F} A }  \mathsf{ret} (v)\). 
\end{lemma}

\begin{proof}
  Let \(f  \mathrel{( \lhd _A  \Rightarrow {\kw{adq}} )}  g\). We need to show that \((f^ \sharp ( \eta _ \mathsf{T} (a)))  \mathrel{\kw{adq}}  ( \mathsf{ret} (v); g)\). Computing the denotational semantics and applying \cref{prop:head-exp}, it suffices to show that \((f~a) \mathrel{\kw{adq}} (g~v)\), which follows from our assumption. 
\end{proof}

\begin{lemma}\label[lem]{lem:fllr-seq}
  If \(d  \lhd _{ \mathsf{U} \mathsf{F} A } e\) and \(f  \lhd _{ \mathsf{U} (A  \to  X) } g\), then \(f^ \sharp (d)  \lhd _{ \mathsf{U} X } e; g\).
\end{lemma}

\begin{proof}
  \par{By induction on \(X\).}  \begin{enumerate}
    \item{If \(X =  \mathsf{F} B\), let \(h  \mathrel{( \lhd _B  \Rightarrow   \mathsf{adq} )}  i\). We need to show that \(h^ \sharp (f^ \sharp (d))  \mathrel{\mathsf{adq}}  (e; g); i\). Computing the denotational semantics and using the fact that we may reassociate sequences (\cref{prop:prof-assoc}), it suffices to show \(((h^ \sharp   \circ  f)^ \sharp (d))  \mathrel{\mathsf{adq}}  (e; ( \lambda  v.~g~v; i))\). By the assumption that \(d  \lhd _{ \mathsf{U} \mathsf{F} A } e\), it suffices to show that for all \(a  \lhd _A v\), we have that \((h^ \sharp (f~a))  \mathrel{\mathsf{adq}}  (g~v; i)\), which follows directly from the assumptions that \(f  \lhd _{ \mathsf{U} (A  \to  X) } g\) and \(h  \mathrel{( \lhd _B  \Rightarrow   \mathsf{adq} )}  i\). 
    }    \item{If \(X = B  \to  Y\), suppose that \(b  \lhd _B v\). We need to show that \((f^ \sharp (d))~b  \lhd _{ \mathsf{U} Y } (e; g)~v\). Unraveling the denotational semantics and the computational semantics (using \cref{prop:comm-app-seq}), it suffices to show \(( \lambda  d.~f~d~b)^ \sharp ~d  \lhd _{ \mathsf{U} Y } (e;  \lambda  d.~g~d~v)\), which follows from the inductive hypothesis and the assumption that \(f  \lhd _{ \mathsf{U} (A  \to  (B  \to  Y)) } g\). }
\end{enumerate}
\end{proof}

\begin{lemma}\label[lem]{lem:fllr-step}
  If \(d  \lhd _X e\), then \(c  \boxplus  d  \lhd _X  \mathsf{step} ^c(e)\). 
\end{lemma}

\begin{proof}
  Since \(\mathsf{step} ^c(e)  \mapsto  c, e\), the result holds by \cref{prop:head-exp}.
\end{proof}

\ThmFLLR* 

\begin{proof}
  By \cref{lem:fllr-ret,lem:fllr-seq,lem:fllr-step,prop:formal-adm}. 
\end{proof}

\ThmNoninterference* 

\begin{proof}
  Let $c : \mathbb{C}$ and $d : \mathbb{C}$ be the costs denoted by $\kw{eval}(e~x, \kw{ret}(v))$ and $\kw{eval}(e~y, \kw{ret}(u))$. By soundness \cref{thm:sound} and laws of the derived algebra \cref{prop:cost-alg-laws}, we have that $\sem{e~x} = c \costmap \eta_\mathbb{T}(\sem{v}) = \eta_\mathbb{L}(c, \sem{v})$ and similarly $\sem{e~y} =\costmap \eta_\mathbb{T}(\sem{u}) = \eta_\mathbb{L}(d, \sem{u})$. It suffices to show that $\sem{v} =_2 \sem{u}$. Because 2 is a purely extensional type (as required by \cref{def:axioms}), we may assume that $\P$ holds. By assumption and soundness, we have $\sem{x} = \sem{y}$, and so $\sem{e~x} = \eta_\mathbb{L}(c, \sem{v}) = \eta_\mathbb{L}(d, \sem{u}) = \sem{e~y}$, which means that $\sem{v} = \sem{u}$ since $c = d$ as elements of a purely intensional type $\mathbb{C}$. 
\end{proof}
