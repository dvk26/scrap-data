%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Preliminary Results and Proofs of Lemmas \ref{lem:optimality_backward_induction}, \ref{lem:entropy_integral_bound}, \ref{lem:helpful_lemma}, \ref{lem:bound_influence_difference_function}, and \ref{lem:asymptotic_estimated_policy_difference_function}}
\label{app:proofs_of_lemmas}

\setcounter{equation}{0}
\renewcommand{\theequation}{B.\arabic{equation}}

\subsection{Preliminary Results and Proofs of Lemmas \ref{lem:optimality_backward_induction}, \ref{lem:entropy_integral_bound}, and \ref{lem:bound_influence_difference_function}}\label{app:preliminary_results}

This section presents several preliminary results and proofs of Lemmas \ref{lem:optimality_backward_induction}, \ref{lem:entropy_integral_bound}, and \ref{lem:bound_influence_difference_function}.
We begin by providing the proof of Lemma \ref{lem:entropy_integral_bound}.

Lemma \ref{lem:covering_number_of_product} below establishes a connection between the $\epsilon$-Hamming covering numbers of classes for stage-specific policies and a class for sequences of policies, and will be used to prove Lemma \ref{lem:entropy_integral_bound}.

\medskip

\begin{lemma}\label{lem:covering_number_of_product}
Given a class of DTRs $\Pi=\Pi_1 \times \cdots \times \Pi_T$, for any integers $s$ and $t$ such that $1\leq s \leq t \leq T$, the following inequality holds: $$N_{d_h}((t-s + 1)\epsilon,\Pi_{s:t}) \leq \prod_{\ell=s}^{t}N_{d_h}(\epsilon,\Pi_{\ell}).$$
\end{lemma}

\begin{proof}
Fix a set of history points $\{h_{t}^{(1)},\ldots,h_{t}^{(n)}\} \subseteq \MH_h$. For any integer $\ell$ ($\leq t$), let $h_{\ell}^{(i)} (\subseteq h_{t}^{(i)})$ be the partial history up to stage $\ell$. Let $K_\ell  \equiv  N_{d_h}(\epsilon,\Pi_\ell,\{h_{\ell}^{(1)},\ldots,h_{\ell}^{(n)}\})$. For each $\ell\in \{s,\ldots,t\}$, we denote by $\widetilde{\Pi}_{\ell} \equiv \left(\pi_{\ell}^{(1)},\ldots,\pi_{\ell}^{(K_{\ell})}\right)$ the set of policies such that for any $\pi_{\ell} \in \Pi_{\ell}$, there exists $\pi_{\ell}^{(i)} \in \widetilde{\Pi}_{\ell}$ satisfying $d_{h}(\pi_{\ell},\pi_{\ell}^{(i)}) \leq \epsilon$. Such a set of policies exists from the definition of $N_{d_h}(\epsilon,\Pi_\ell,\{h_{\ell}^{(1)},\ldots,h_{\ell}^{(n)}\})$.

Fix $\pi_{s:t} \in \Pi_{s:t}$, and define $\widetilde{\Pi}_{s:t} \equiv \widetilde{\Pi}_{s}\times \cdots \times \widetilde{\Pi}_{t}$. Let $\tilde{\pi}_{s:t}=(\tilde{\pi}_s,\ldots,\tilde{\pi}_t) \in\widetilde{\Pi}_{s:t}$ be such that for any $\ell \in \{s,\ldots,t\}$, $d_{h}(\pi_{\ell},\tilde{\pi}_{\ell}) \leq \epsilon$. Then
\begin{align*}
    d_h(\pi_{s:t},\tilde{\pi}_{s:t}) & = \frac{1}{n}\sum_{i=1}^{n}1\{\pi_{s}(h_{s}^{(i)})\neq \tilde{\pi}_{s}(h_{s}^{(i)}) \vee \cdots \vee \pi_{t}(h_{t}^{(i)})\neq \tilde{\pi}_{t}(h_{t}^{(i)})\} \\
    & \leq \sum_{\ell=s}^{t} \left(\frac{1}{n}\sum_{i=1}^{n}1\{\pi_{\ell}(h_{\ell}^{(i)})\neq \tilde{\pi}_{\ell}(h_{\ell}^{(i)})\}\right)\\
    &= \sum_{\ell=s}^{t} d_h(\pi_{\ell},\tilde{\pi}_{\ell}) \leq (t-s+1)\epsilon.
\end{align*}
Therefore, for any $\pi_{s:t} \in \Pi_{s:t}$, there exists $\tilde{\pi}_{s:t}\in \widetilde{\Pi}_{s:t}$ such that $d_h(\pi_{s:t},\tilde{\pi}_{s:t}) \leq (t-s+1)\epsilon$. Since $\left|\widetilde{\Pi}_{s:t}\right| = \prod_{\ell=s}^{t}\left|\widetilde{\Pi}_{\ell}\right|=\prod_{\ell=s}^{t}N_{d_h}(\epsilon,\Pi_\ell,\{h_{\ell}^{(1)},\ldots,h_{\ell}^{(n)}\})$, where $|\cdot|$ denotes the cardinality, we have
\begin{align*}
    N_{d_h}\left((t-s+1)\epsilon,\Pi_{s:t},\{h_{t}^{(1)},\ldots,h_{t}^{(n)}\}\right) \leq \prod_{\ell=s}^{t}N_{d_h}\left(\epsilon,\Pi_\ell,\{h_{\ell}^{(1)},\ldots,h_{\ell}^{(n)}\}\right).
\end{align*}
As this holds for any $n$ and any set of history points $\{h_{t}^{(1)},\ldots,h_{t}^{(n)}\}$, the result in the statement holds.
\end{proof}

\medskip

Using Lemma \ref{lem:covering_number_of_product}, we present the proof of Lemma \ref{lem:entropy_integral_bound} below.

\bigskip
\noindent
\textit{Proof of Lemma \ref{lem:entropy_integral_bound}}.
Note that $\Pi=\Pi_{1:T}$. Applying Lemma \ref{lem:covering_number_of_product} to $\Pi$, we have $N_{H}(\epsilon^2,\Pi) \leq \prod_{t=1}^{T} N_{H}(\epsilon^2/T,\Pi_{t})$. Then
\begin{align*}
\kappa(\Pi)&=\int_{0}^{1}\sqrt{\log N_{H}\left(\epsilon^{2},\Pi\right)}d\epsilon 
\leq\int_{0}^{1}\sqrt{\sum_{t=1}^{T}\log N_{H}(\epsilon^{2}/T,\Pi_{t})}d\epsilon\\
&\leq \sum_{t=1}^{T} \int_{0}^{1}\sqrt{\log N_{H}(\epsilon^{2}/T,\Pi_{t})}d\epsilon\\
&\leq T \int_{0}^{1}\sqrt{\log C+D\left(\frac{\sqrt{T}}{\epsilon}\right)^{2\omega}}d\epsilon \\
&\leq T \int_{0}^{1}\sqrt{\log C}d\epsilon+ T\int_{0}^{1}\sqrt{D\left(\frac{\sqrt{T}}{\epsilon}\right)^{2\omega}}d\epsilon\\
&=T\sqrt{\log C}+\sqrt{T^{(2+\omega)}}\sqrt{D}\int_{0}^{1}\epsilon^{-\omega}d\epsilon=T\sqrt{\log C}+\frac{\sqrt{T^{(2+\omega)}D}}{1-\omega} \\
&<\infty,    
\end{align*}
where the third and last lines follow from Assumption \ref{asm:bounded entropy}.\hfill {\large $\Box$}

\bigskip


We next give several preliminary results. We first define the conditional policy value of $\pi_{t:T}$ for stage $t$ as, for any $h_{t} = (\underline{a}_{t-1},\underline{s}_{t}) \in \MH_{t}$,
\begin{align*}
    V_{t}\left(\pi_{t:T};h_{t}\right) \equiv E\left[\sum_{s=t}^{T}\sum_{\underline{a}_{t:s}^{\prime} \in \underline{\MA}_{t:s}}\left( Y_{s}(\underline{a}_{t-1},\underline{a}_{t:s}^{\prime})\cdot \prod_{\ell=t}^{s}1\{\pi_{\ell}\left(H_{\ell}(\underline{a}_{t-1},\underline{a}_{t:(\ell-1)}^{\prime})\right)=a_{\ell}^{\prime}\}\right)\middle| H_{t}=h_{t}\right],
\end{align*}
where $H_{\ell}(\underline{a}_{(t-1)},\underline{a}_{t:(\ell-1)}^{\prime})=H_{t}(\underline{a}_{(t-1)})$ for $\ell=t$.
Note that $E\left[V_t(\pi_{t:T};H_{t})\right] = V_{t}(\pi_{t:T})$. For ease of notations, for any stages $s$ and $t$ such that $s \geq t$ and any policy sequence $\pi_{t:s}\in \Pi_{t:s}$, we define
\begin{align*}
    \widetilde{Y}_{t:s}\left(\underline{a}_{t-1},\pi_{t:s}\right) \equiv \sum_{\underline{a}_{t:s}^{\prime} \in \underline{\MA}_{t:s}}\left( Y_{s}(\underline{a}_{t-1},\underline{a}_{t:s}^{\prime})\cdot \prod_{\ell=t}^{s}1\{\pi_{\ell}\left(H_{\ell}(\underline{a}_{t-1},\underline{a}_{t:(\ell-1)}^{\prime})\right)=a_{\ell}^{\prime}\}\right).
\end{align*}
Let $\widetilde{Y}_{t}\left(\underline{a}_{t-1},\pi_{t}\right)$ denote $\widetilde{Y}_{t:s}\left(\underline{a}_{t-1},\pi_{t:s}\right)$ when $t=s$. Note that, for any $\pi_{t:T} \in \Pi_{t:T}$ and $h_{t} = (\underline{a}_{t-1},\underline{s}_{t}) \in \MH_{t}$, $V(\pi_{t:T};h_{t})$ can be written as  $$E\left[\sum_{s=t}^{T}\widetilde{Y}_{t:s}\left(\underline{a}_{t-1},\pi_{t:s}\right) \middle| H_{t}=h_{t}\right] = V_{t}(\pi_{t:T};h_{t}).$$

The following lemma will used in the proofs of Lemmas \ref{lem:optimality_backward_induction}, \ref{lem:bound_influence_difference_function}, and \ref{lem:asymptotic_estimated_policy_difference_function}.

\medskip{}

\begin{lemma}\label{lemma:identification}
Suppose that Assumption \ref{asm:sequential independence} holds. Then, for any stage $t$ and DTR $\pi \in \Pi$, the following hold:
\begin{itemize}
\item[(i)] $Q_{t}^{\pi_{(t+1):T}}(h_{t},\pi_{t}) = V_{t}(\pi_{t:T};h_{t})$ for any $h_{t} \in \MH_{t}$;
%    \item[(ii)] $E\left[Q_{t}^{\pi_{(t+1):T}}(H_{t},\pi_{t})\right] = V_{t}(\pi_{t:T})$;
    \item[(ii)] $E\left[\widetilde{V}_{i,t}(\pi_{t:T})\right] = V_{t}(\pi_{t:T})$ for any $i=1,\ldots,n$. 
\end{itemize}
\end{lemma}
\medskip

\begin{proof}
    We first prove (i), where we basically follow the proof of \citeauthor{Tsiatis_et_al_2019} (\citeyear{Tsiatis_et_al_2019}, equation (6.53)). For $t=T$, the following holds for any $h_{T} = (\underline{a}_{T-1},\underline{s}_{T}) \in \MH_{T}$:
    \begin{align}
        Q_{T}(h_{T},\pi_{T}) 
        &= E\left[Y_{T}|A_{T}=\pi_{T}(h_{T}),H_{T}=h_T\right] \nonumber \\
        &= E\left[Y_{T}(\underline{A}_{T})|A_{T}=\pi_{T}(h_{T}),H_{T}=h_{t}\right] \nonumber \\
        &= E\left[Y_{T}(\underline{a}_{T-1},\pi_{T}(h_{T}))|A_{T}=\pi_{T}(h_{T}),H_{T}=h_{t}\right] \nonumber \\
        &= \sum_{a_{T} \in \MA_{T}}E\left[Y_{T}(\underline{a}_{T-1},a_{T}) \cdot 1\{a_{T} = \pi_{T}(h_{T})\}\middle|A_{T}=a_{T},H_{T}=h_{t}\right] \nonumber \\
         &= \sum_{a_{T} \in \MA_{T}} E\left[Y_{T}(\underline{a}_{T-1},a_{T}) \cdot 1\{a_{T} = \pi_{T}(h_{T})\}\middle|H_{T}=h_{t}\right] \nonumber \\
        &= E\left[\sum_{a_{T} \in \MA_{T}}Y_{T}(\underline{a}_{T-1},a_{T}) \cdot 1\{a_{T} = \pi_{T}(H_{T}(\underline{a}_{T-1}))\}\middle| H_{T}=h_{T}\right]  \nonumber \\
        &= V_{T}(\pi_{T};h_{T}), \label{eq:Q_T_V_T}
    \end{align}
    where the fifth equality follows from Assumption \ref{asm:sequential independence}. %Hence, taking the expectation with respect to $H_{T}$ leads to $E\left[Q_{T}(H_{T},\pi_{T})\right] = V_{T}(\pi_{T})$.
    
For any integer $t$ such that $t <T$, the following holds for any $h_{t} = (\underline{a}_{t-1},\underline{s}_{t}) \in \MH_{t}$:
\begin{align}
   & E\left[Y_{t} + V_{t+1}(\pi_{(t+1):T};H_{t+1}) | A_{t}=\pi_{t}(h_{t}),H_{t}=h_{t}\right] \nonumber\\
      &=E\left[Y_{t}\left(\underline{a}_{t}\right) + \sum_{s=t+1}^{T}\widetilde{Y}_{(t+1):s}(\underline{a}_{t-1},\pi_{t}(h_{t}),\pi_{(t+1):s})\middle| A_{t}=\pi_{t}(h_{h}),H_{t}=h_{t}\right] \nonumber \\
            &=\sum_{a_{t} \in \MA_{t}}\left(E\left[Y_{t}\left(\underline{a}_{t-1},a_{t}\right) + \sum_{s=t+1}^{T}\widetilde{Y}_{(t+1):s}(\underline{a}_{t-1},a_{t},\pi_{(t+1):s})\middle| A_{t}=a_{t},H_{t}=h_{t}\right] \cdot 1\{\pi_{t}(h_{t}) = a_{t}\}\right) \nonumber \\
             &=\sum_{a_{t} \in \MA_{t}}\left(E\left[Y_{t}\left(\underline{a}_{t-1},a_{t}\right) + \sum_{s=t+1}^{T}\widetilde{Y}_{(t+1):s}(\underline{a}_{t-1},a_{t},\pi_{(t+1):s})\middle| H_{t} = h_{t}\right] \cdot 1\{\pi_{t}(h_{t}) = a_{t}\}\right) \nonumber \\
            &=E\left[Y_{t}\left(\underline{a}_{t-1},\pi_{t}(h_{t})\right) + \sum_{s=t+1}^{T}\widetilde{Y}_{(t+1):s}(\underline{a}_{t-1},\pi_{t}(h_{t}),\pi_{(t+1):s})\middle| H_{t}=h_{t}\right] \nonumber \\
        &=E\left[Y_{t}\left(\underline{a}_{t-1},\pi_{t}(h_{t})\right) + \sum_{s=t+1}^{T}\widetilde{Y}_{(t+1):s}(\underline{A}_{t-1},\pi_{t}(h_{t}),\pi_{(t+1):s})\middle| H_{t}=h_{t}\right] \nonumber \\
   & =E\left[\sum_{s=t}^{T}\widetilde{Y}_{s}(\underline{a}_{t-1},\pi_{t:s})\middle|H_{t} = h_{t}\right] \nonumber \\
   &=V_{t}(\pi_{t:T};h_{t}), \label{eq:V_t+1_V_t}
\end{align}
where the first equality follows from the law of total expectations, and the third equality follows from Assumption \ref{asm:sequential independence}. 

When $t=T-1$,
\begin{align*}
    Q_{T-1}^{\pi_{T}}(h_{T-1},\pi_{T-1})
    &= E\left[Y_{T-1} + Q_{T}(H_{T},\pi_{T})|A_{T-1}=\pi_{T-1}(h_{T-1}),H_{T-1}=h_{T-1}\right] \\
    &= E\left[Y_{T-1} + V_{T}(\pi_{T};H_{T})|A_{T-1}=\pi_{T-1}(h_{T-1}),H_{T-1}=h_{T-1}\right]\\
    &= V_{T-1}(\pi_{(T-1):T};h_{T-1}),
\end{align*}
where the second and third equalities follow from equations (\ref{eq:Q_T_V_T}) and (\ref{eq:V_t+1_V_t}), respectively. Recursively applying the same argument from $t=T-2$ to $1$, we have $Q_{t}^{\pi_{(t+1):T}}(h_{t},\pi_{t}) = V_{t}(\pi_{t:T};h_{t})$ for any $t$ and $h_{t} \in \MH_{t}$,  which leads to the result (i). %The result (ii) follows from the result (i) by taking the expectation with respect to $H_{t}$.

We proceed to prove (ii). Given a fixed DTR $\pi=(\pi_1,\ldots,\pi_T)$, to simply notation, we define the independent copies of $\{\widetilde{V}_{i,t}(\pi_{t:T}):t=1,\ldots,T\}$ as follows:
\begin{align*}
\widetilde{V}_{T}(\pi_{T}) &\equiv \frac{ Y_{T} - Q_{T}(H_{T},A_{T}) }{e_{T}(H_{T},A_{T})}\cdot 1\{A_{T}=\pi_{T}(H_{T})\} + Q_{T}(H_{T},\pi_{T}(H_{T})),
\end{align*}
and, recursively for $t=T-1,\ldots,1$,
\begin{align*}
\widetilde{V}_{t}(\pi_{t:T}) &\equiv \frac{ Y_{t} + \widetilde{V}_{t+1}(\pi_{(t+1):T}) - Q_{t}^{\pi_{(t+1):T}}(H_{t},A_{t}) }{e_{t}(H_{t},A_{t})}\cdot 1\{A_{t}=\pi_{t}(H_{t})\} \\
&+ Q_{t}^{\pi_{(t+1):T}}(H_{t},\pi_{t}(H_{t})).
\end{align*}
Note that $E\left[\widetilde{V}_{T}(\pi_{T})\right]=E\left[\widetilde{V}_{i,T}(\pi_{T})\right]$ and $E\left[\widetilde{V}_{t}(\pi_{t:T})\right]=E\left[\widetilde{V}_{i,t}(\pi_{t:T})\right]$ for any $i$ and $t$.

We first consider the case that $t=T$. Regarding the first component in $\widetilde{V}_{T}(\pi_{T})$, for any $h_{T} \in \MH_{T}$,
\begin{align*}
    &E\left[Y_{T} \cdot \frac{1\{A_{T}=\pi_{T}(H_{T})\}}{e_{T}(H_{T},A_{T})} \middle| H_{T}=h_{T}\right]\\
        &= E\left[E\left[Y_{T}\middle|A_{T}=\pi_{T}(H_{T}), H_{T} \right] \cdot \frac{1\{A_{T}=\pi_{T}(H_{T})\}}{e_{T}(H_{T},A_{T})} \middle| H_{T}=h_{T}\right]\\
    &= E\left[Q_{T}(H_{T},\pi_{T}) \cdot \frac{1\{A_{T}=\pi_{T}(H_{T})\}}{e_{T}(H_{T},A_{T})} \middle| H_{T}=h_{T}\right],
\end{align*}
where the last equality follows from the definition of $Q_{T}(H_{T},\pi_{T})$.

Therefore, we have
\begin{align}
    &E\left[\widetilde{V}_{T}(\pi_{T}) \middle| H_{i,T} = h_{T}\right] \nonumber\\
    &= E\left[\left(Q_{T}(H_{T},A_{T}) - Q_{T}(H_{T},A_{T})\right) \cdot \frac{1\{A_{T}=\pi_{T}(H_{T})\}}{e_{T}(H_{T},A_{T})} \middle| H_{T}=h_{T}\right] + Q_{T}(h_{T},\pi_{T}) \nonumber \\
    &= Q_{T}(h_{T},\pi_{T})  = V_{T}(\pi_{T};h_{T}), \label{eq:V_tile_T_to_V_T}
\end{align}
where the last equality follows from the result (i).
We consequently have $E\left[\widetilde{V}_{T}(\pi_{T})\right] = E[V_{T}(\pi_{T};H_{T})] = V_{T}(\pi_{T})$.

When $t=T-1$, for any $h_{T-1} \in \MH_{T-1}$,
\begin{align*}
    &E\left[\left(Y_{T-1} + \widetilde{V}_{T}(\pi_{T})\right) \cdot \frac{1\{A_{T-1}=\pi_{T-1}(H_{T-1})\}}{e_{T}(H_{T-1},A_{T-1})} \middle| H_{T-1}=h_{T-1}\right]\\
    &=E\left[\left(Y_{T-1} + E\left[\widetilde{V}_{T}(\pi_{T})\middle| H_{T}\right]\right) \cdot \frac{1\{A_{T-1}=\pi_{T-1}(H_{T-1})\}}{e_{T}(H_{T-1},A_{T-1})} \middle| H_{T-1}=h_{T-1}\right]\\
    &= E\left[\left(Y_{T-1} + V_{T}(\pi_{T};H_{T})\right) \cdot \frac{1\{A_{T-1}=\pi_{T-1}(H_{T-1})\}}{e_{T}(H_{T-1},A_{T-1})} \middle| H_{T-1}=h_{T-1}\right]\\
    &= E\left[\left(Y_{T-1} + Q_{T}(H_{T},\pi_{T})\right) \cdot \frac{1\{A_{T-1}=\pi_{T-1}(H_{T-1})\}}{e_{T}(H_{T-1},A_{T-1})} \middle| H_{T-1}=h_{T-1}\right]\\
     &= E\left[E\left[Y_{T-1} + Q_{T}(H_{T},\pi_{T})\middle| A_{T-1}=\pi_{T-1}(H_{T-1}),H_{T-1}\right]\right.\\
     &\left. \times \frac{1\{A_{T-1}=\pi_{T-1}(H_{T-1})\}}{e_{T}(H_{T-1},A_{T-1})} \middle| H_{T-1}=h_{T-1}\right]\\
     &= E\left[Q_{T-1}^{\pi_{T}}(H_{T-1},A_{T-1}) \cdot \frac{1\{A_{T-1}=\pi_{T-1}(H_{T-1})\}}{e_{T}(H_{T-1},A_{T-1})} \middle| H_{T-1}=h_{T-1}\right],
\end{align*}
where the second equality follows from the result (\ref{eq:V_tile_T_to_V_T}); the third equality follow from the result (i); the last equality follows from the definition of the Q-function $Q_{T-1}^{\pi_T}(\cdot,\cdot)$.

Therefore, for any $h_{T-1} \in \MH_{T-1}$,
\begin{align*}
    &E\left[\widetilde{V}_{T-1}(\pi_{(T-1):T})\middle| H_{T-1} = h_{T-1}\right]\\
    & = E\left[\left(Y_{T-1} + \widetilde{V}_{T}(\pi_{T}) - Q_{T-1}^{\pi_{T}}(H_{T-1},A_{T-1})\right) \cdot \frac{1\{A_{T-1}=\pi_{T-1}(H_{T-1})\}}{e_{T}(H_{T-1},A_{T-1})} \middle| H_{T-1}=h_{T-1}\right] \\
    &+ Q_{T-1}^{\pi_{T}}(h_{T-1},\pi_{T-1})\\
    & = E\left[\left(Q_{T-1}^{\pi_{T}}(H_{T-1},A_{T-1}) - Q_{T-1}^{\pi_{T}}(H_{T-1},A_{T-1})\right) \cdot \frac{1\{A_{T-1}=\pi_{T-1}(H_{T-1})\}}{e_{T}(H_{T-1},A_{T-1})} \middle| H_{T-1}=h_{T-1}\right] \\
    &+ Q_{T-1}^{\pi_{T}}(h_{T-1},\pi_{T-1})\\
& =  Q_{T-1}^{\pi_{T}}(h_{T-1},\pi_{T-1}) = V_{T-1}(\pi_{(T-1):T};h_{T-1}),
\end{align*}
where the last equality follows from the result (i). Hence, we have $E\left[\widetilde{V}_{T-1}(\pi_{(T-1):T})\right] = E\left[V_{T-1}(\pi_{(T-1):T};H_{T-1})\right] = V_{T-1}(\pi_{(T-1):T})$.

Recursively applying the same argument from $t=T-2$ to $1$, we have $E\left[\widetilde{V}_{t}(\pi_{t:T})\right] = V_{t}(\pi_{t:T})$ for any $t$, which proves the result (iii).
\end{proof}

\medskip

We next provide the proof of Lemma \ref{lem:optimality_backward_induction}, which extends the proof of \citeauthor{Tsiatis_et_al_2019} (\citeyear{Tsiatis_et_al_2019}, equation (7.21)) to the case under Assumption \ref{asm:first-best}.

\bigskip
\noindent
\textit{Proof of Lemma \ref{lem:optimality_backward_induction}}.
Let $\pi \in \Pi$ be fixed. Under Assumptions \ref{asm:overlap} and \ref{asm:first-best}, $\pi^{\ast,B}$ satisfies the condition in Assumption \ref{asm:first-best}.
\begin{comment}
For the final stage $T$, we first compare the welfares of $\pi$ and $(\pi_{1:(T-1)},\pi_{T}^{\ast,B})$ as follows:
\begin{align*}
    &W(\pi_{1:(T-1)},\pi_{T}^{\ast,B}) - W(\pi) \\
    &= V_{1}(\pi_{1:(T-1)},\pi_{T}^{\ast,B}) - V_{1}(\pi) \\
    &= E\left[Q_{1}^{\pi_{2:(T-1)},\pi_{T}^{\ast,B}}(H_{1},\pi_{1}) - Q_{1}^{\pi_{2:T}}(H_{1},\pi_{1})\right] \\
    &=E\left[E\left[Q_{T}(H_{T},\pi_{T}^{\ast,B}) - Q_{T}(H_{T},\pi_{T})\middle| A_{1}=\pi_{1}(H_1),\ldots, A_{T-1}=\pi_{T-1}(H_{T-1}), H_{T-1} \right] \right] \\
    &\geq 0,
\end{align*}
where the second equality follows from Lemma \ref{lemma:identification} (i), third equality follows from the definitions of the Q-functions, and the inequality follows from Assumption \ref{asm:first-best}. We therefore obtain $$W(\pi_{1:(T-1)},\pi_{T}^{\ast,B}) \geq W(\pi).$$
\end{comment}
For any $t=1,\ldots,T$,  comparing the welfares of $(\pi_{1:(t-1)},\pi_{t:T}^{\ast,B})$ and $(\pi_{1:t},\pi_{(t+1):T}^{\ast,B})$ yields:
\begin{align*}
    &W(\pi_{1:(t-1)},\pi_{t:T}^{\ast,B}) - W(\pi_{1:t},\pi_{(t+1):T}^{\ast,B}) \\
    &= V_{1}(\pi_{1:(t-1)},\pi_{t:T}^{\ast,B}) - V_{1}(\pi_{1:t},\pi_{(t+1):T}^{\ast,B}) \\
    &= E\left[Q_{1}^{\pi_{2:(t-1)},\pi_{t:T}^{\ast,B}}(H_{1},\pi_{1}) - Q_{1}^{\pi_{2:t},\pi_{(t+1):T}^{\ast,B}}(H_{1},\pi_{1})\right] \\
    &=E\left[E\left[Q_{t}^{\pi_{(t+1):T}^{\ast,B}}(H_{t},\pi_{t}^{\ast,B}) - Q_{t}^{\pi_{(t+1):T}^{\ast,B}}(H_{t},\pi_{t})\middle| A_{1}=\pi_{1}(H_1),\ldots, A_{t-1}=\pi_{t-1}(H_{t-1}), H_{t-1} \right] \right] \\
    &\geq 0,
\end{align*}
where we denote $W(\pi_{1:(0)},\pi_{1:T}^{\ast,B})=W(\pi^{\ast,B})$ and $W(\pi_{1:T},\pi_{(T+1):T}^{\ast,B})=W(\pi)$ for $t=1$ and $t=T$, respectively; the second equality follows from Lemma \ref{lemma:identification} (i); the third equality follows from the definitions of the Q-functions; the inequality follows from Assumption \ref{asm:first-best}.   We therefore obtain $W(\pi_{1:(t-1)},\pi_{t:T}^{\ast,B}) \geq W(\pi_{1:t},\pi_{(t+1):T}^{\ast,B})$ for any $t=1,\ldots,T$.

Applying this result, we have 
\begin{align*}
    W(\pi^{\ast,B}) - W(\pi) = \sum_{t=1}^{T}\left(W(\pi_{1:(t-1)},\pi_{t:T}^{\ast,B}) - W(\pi_{1:t},\pi_{(t+1):T}^{\ast,B})\right)
     \geq 0.
\end{align*} Since this result holds for any $\pi \in \Pi$, we obtain the result in Lemma \ref{lem:optimality_backward_induction}. \hfill {\large $\Box$}
\bigskip

The following lemma, which follows from Lemma 2 in \cite{zhou2022offline} and its proof, plays important roles in the proofs of Theorem 
\ref{thm:main_theorem_backward}.

\medskip{}

\begin{lemma} \label{lem:concentration inequality_influence difference function}
Fix integers $s$ and $t$ such that $1\leq s \leq t \leq T$. For any $\underline{a}_{s:t}\in \underline{\MA}_{s:t}$, let $\{\Gamma_{i}^{\dag}(\underline{a}_{s:t})\}_{i=1}^{n}$ be i.i.d. random variables with bounded supports. 
For any $\pi_{s:t} \in \Pi_{s:t}$, we define $\widetilde{Q}(\pi_{s:t})  \equiv  (1/n) \sum_{i=1}^{n}  \Gamma_{i}^{\dag}(\pi_{s:t})$, where $\Gamma_{i}^{\dag}(\pi_{s:t}) \equiv \Gamma_{i}^{\dag}((\pi_{s}(H_{i,s}),\ldots,\pi_{t}(H_{i,t})))$ and $Q(\pi_{s:t}) \equiv  E[\widetilde{Q}(\pi_{s:t})]$. For any $\pi_{s:t}^{a},\pi_{s:t}^{b} \in \Pi_{s:t}$, let $\widetilde{\Delta}(\pi_{s:t}^{a},\pi_{s:t}^{b}) \equiv \widetilde{Q}(\pi_{s:t}^{a}) - \widetilde{Q}(\pi_{s:t}^{b})$ and $\Delta(\pi_{s:t}^{a},\pi_{s:t}^{b}) \equiv Q(\pi_{s:t}^{a}) - Q(\pi_{s:t}^{b})$. Then, when $\kappa(\Pi_{s:t}) < \infty$, the following holds: For any $\delta \in (0,1)$, with probability at least $1-2\delta$,
\begin{align*}
    \sup_{\pi_{s:t}^{a},\pi_{s:t}^{b} \in \Pi_{s:t}} \left|\widetilde{\Delta}(\pi_{s:t}^{a},\pi_{s:t}^{b})-\Delta(\pi_{s:t}^{a},\pi_{s:t}^{b})\right| &\leq \left(54.4 \sqrt{2}\kappa(\Pi_{s:t}) + 435.2 + \sqrt{2 \log \frac{1}{\delta}}\right)\sqrt{\frac{V_{s:t}^{\ast}}{n}} \\
    &+ o\left(\frac{1}{\sqrt{n}}\right),
\end{align*}
where 
    $V_{s:t}^{\ast}  \equiv  \sup_{\pi_{s:t}^{a},\pi_{s:t}^{b} \in \Pi_{s:t}}E
    \left[\left(\Gamma_{i}^{\dag}(\pi_{s:t}^{a}) - \Gamma_{i}^{\dag}(\pi_{s:t}^{b}) \right)^2\right] < \infty$.
\end{lemma}

\medskip

Using Lemma \ref{lem:concentration inequality_influence difference function}, we present the proof of Lemma \ref{lem:bound_influence_difference_function} as follows.

\bigskip

\noindent
\textit{Proof of  Lemma \ref{lem:bound_influence_difference_function}.}
Given a fixed DTR $\pi=(\pi_1,\ldots,\pi_T)$, we define the recursive expression for $t=T,\ldots,1$ as
\begin{align*}
\widetilde{\Gamma}_{i,t}^{\pi_{(t+1):T}}(\underline{a}_{t:T}) &\equiv \frac{Y_{i,t} + \widetilde{\Gamma}_{i,t+1}^{\pi_{(t+2):T}}(\underline{a}_{(t+1):T}) - Q_{t}^{\pi_{(t+1):T}}(H_{i,t},A_{i,t}) }{e_{t}(H_{i,t},A_{i,t})}\cdot 1\{A_{i,t}=a_{t}\} \\
&+ Q_{t}^{\pi_{(t+1):T}}(H_{i,t},a_{t}),
\end{align*}
where we assume $\widetilde{\Gamma}_{i,t}^{\pi_{(t+1):T}}(\underline{a}_{t:T}) = 0$ when $t=T+1$.
For any ${\pi}_{(t+1):T} \in \Pi_{(t+1):T}$ and ${\pi}_{t:T}^{\prime} = (\pi_{t}^{\prime},\ldots,\pi_{T}^{\prime}) \in \Pi_{t:T}$, let $\widetilde{\Gamma}_{i,t}^{{\pi}_{(t+1):T}}(\pi_{t:T}^{\prime}) \equiv \widetilde{\Gamma}_{i,t}^{{\pi}_{(t+1):T}}(\pi_{t}^{\prime}(H_{i,t}),\ldots,\pi_{T}^{\prime}(H_{i,T}))$.
Note that $\widetilde{\Gamma}_{i,t}^{{\pi}_{(t+1):T}}(\pi_{t:T}) = \widetilde{V}_{i,t}(\pi_{t:T})$. 

Fix $\pi_{(t+1):T} \in \Pi_{(t+1):T}$. For any $\pi_{t:T}^{a}, \pi_{t:T}^{b} \in \Pi_{t:T}$, we define 
\begin{align*}
    \widetilde{\Delta}^{\pi_{(t+1):T}} (\pi_{t:T}^{a},\pi_{t:T}^{b}) \equiv \frac{1}{n}\sum_{i=1}^{n}\left(\widetilde{\Gamma}_{i,t}^{\pi_{(t+1):T}}(\pi_{t:T}^{a}) - \widetilde{\Gamma}_{i,t}^{\pi_{(t+1):T}}(\pi_{t:T}^{b})\right)
\end{align*}
and
\begin{align*}
    \Delta^{\pi_{(t+1):T}} (\pi_{t:T}^{a},\pi_{t:T}^{b}) \equiv E\left[\frac{1}{n}\sum_{i=1}^{n}\left(\widetilde{\Gamma}_{i,t}^{\pi_{(t+1):T}}(\pi_{t:T}^{a}) - \widetilde{\Gamma}_{i,t}^{\pi_{(t+1):T}}(\pi_{t:T}^{b})\right)\right].
\end{align*}
Note that 
\begin{align*}
\widetilde{\Delta}^{\pi_{(t+1):T}}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T})
    = \widetilde{\Delta}_{t}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T}),
\end{align*}
where $\widetilde{\Delta}_{t}(\cdot;\cdot)$ is defined in (\ref{eq:Delta_tilde}). Noting that 
\begin{align*}
    \Delta^{\pi_{(t+1):T}}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T}) = E\left[\widetilde{V}_{i,t}(\pi_{t}^{a},\pi_{(t+1):T})\right] - E\left[\widetilde{V}_{i,t}(\pi_{t}^{b},\pi_{(t+1):T})\right],
\end{align*}
Lemma \ref{lemma:identification} leads to
\begin{align*}
    \Delta^{\pi_{(t+1):T}}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T}) = \Delta_{t}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T}),
\end{align*}
where $\Delta_{t}(\cdot;\cdot)$ is defined in (\ref{eq:Delta}). 

Therefore, it follows for (\ref{eq:former}) that 
\begin{align}
   & \sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}}\sup_{\pi_{t}^{a},\pi_{t}^{b} \in \Pi_{t}} |\Delta_{t}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T}) - \widetilde{\Delta}_{t}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T})| \nonumber \\
  &=\sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}}\sup_{\pi_{t}^{a},\pi_{t}^{b} \in \Pi_{t}} |\widetilde{\Delta}^{\pi_{(t+1):T}}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T})  - \Delta^{\pi_{(t+1):T}}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T}) | \nonumber \\
  &\leq \sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}} 
  \sup_{\pi_{t:T}^{a},\pi_{t:T}^{b} \in \Pi_{t:T}} 
  |\widetilde{\Delta}^{\pi_{(t+1):T}}(\pi_{t:T}^{a};\pi_{t:T}^{b})  - \Delta^{\pi_{(t+1):T}}(\pi_{t:T}^{a};\pi_{t:T}^{b})|. \label{eq:tilde_delta_inequalty}
\end{align}

Fix $\pi_{(t+1):T} \in \Pi_{(t+1):T}$. Note that $\left\{\widetilde{\Gamma}_{i,t}^{\pi_{(t+1):T}}(\underline{a}_{t:T})\right\}_{i=1,\ldots,n}$ are i.i.d. random variables  with bounded supports under Assumptions \ref{asm:bounded outcome} and \ref{asm:overlap} and that $\kappa(\Pi_{t:T})$ is finite from Lemma \ref{lem:entropy_integral_bound} and $\kappa(\Pi_{t:T}) \leq \kappa(\Pi)$. 
Therefore, fixing $\pi_{(t+1):T}$ and applying Lemma \ref{lem:concentration inequality_influence difference function} with $\Gamma_{i}^{\dag}(\underline{a}_{t:T})=\widetilde{\Gamma}_{i,t}^{\pi_{(t+1):T}}(\underline{a}_{t:T})$ leads to the following result:
For any $\delta \in (0,1)$, with probability at least $1-2\delta$,
\begin{align}
    &\sup_{\pi_{t:T}^{a},\pi_{t:T}^{b} \in \Pi_{t:T}} 
  |\widetilde{\Delta}^{\pi_{(t+1):T}}(\pi_{t:T}^{a};\pi_{t:T}^{b})  - \Delta^{\pi_{(t+1):T}}(\pi_{t:T}^{a};\pi_{t:T}^{b})| \nonumber\\
    &\leq \left(54.4 \sqrt{2}\kappa(\Pi_{t:T}) + 435.2 + \sqrt{2 \log \frac{1}{\delta}}\right)\sqrt{\frac{V_{t:T}^{\pi_{(t+1):T},\ast}}{n}} + o\left(\frac{1}{\sqrt{n}}\right), \label{eq:bound_influence_difference_function_2}
\end{align}
with $V_{t:T}^{\pi_{(t+1):T},\ast}  \equiv  \sup_{\pi_{t:T}^{a},\pi_{t:T}^{b} \in \Pi_{t:T}}E
    \left[\left(\widetilde{\Gamma}_{i,t}^{\pi_{(t+1):T}}(\pi_{t:T}^{a}) - \widetilde{\Gamma}_{i,t}^{\pi_{(t+1):T}}(\pi_{t:T}^{b}) \right)^2\right]$.
    
Under Assumptions \ref{asm:bounded outcome} and \ref{asm:overlap}, $V_{t:T}^{\pi_{(t+1):T},\ast} \leq M_{t:T}^{\ast} < \infty$ for any $\pi_{(t+1):T}$. Therefore, combining (\ref{eq:tilde_delta_inequalty}) and (\ref{eq:bound_influence_difference_function_2}) leads to the result (\ref{eq:bound_influence_difference_function}). \hfill {\large $\Box$}

\medskip{}

\begin{comment}
\begin{lemma} \label{lem:concentration inequality_influence difference function}
Fix $t \in \{ 1,\ldots,T\}$. Let $\{\Gamma_{i,t}\}_{i=1}^{n}$ be i.i.d. random vectors with bounded support. For any $\pi_{t} \in \Pi_{t}$, let $\widetilde{Q}_{t}(\pi_{t})  \equiv  \frac{1}{n} \sum_{i=1}^{n}\left\langle \pi_{t}(H_{i,t}), \Gamma_{i,t}\right\rangle$ and $Q_{t}(\pi_{t}) \equiv  E[\widetilde{Q}_{t}(\pi_{t})]$. For any $\pi_{t:T}^{a},\pi_{t:T}^{b} \in \Pi_{t}$, denote $\widetilde{\Delta}_{t}(\pi_{t:T}^{a},\pi_{t:T}^{b})= \widetilde{Q}_{t}(\pi_{t}^{a}) - \widetilde{Q}_{t}(\pi_{t})$ and $\Delta_{t}(\pi_{t:T}^{a},\pi_{t:T}^{b})= Q_{t}(\pi_{t}^{a}) - Q_{t}(\pi_{t})$. Then, under Assumption \ref{asm:bounded entropy}, the following hold: For any $\delta \in (0,1)$, with probability at least $1-2\delta$,
\begin{align*}
    \sup_{\pi_{t:T}^{a},\pi_{t:T}^{b} \in \Pi_t} \left|\widetilde{\Delta}_{t}(\pi_{t:T}^{a},\pi_{t:T}^{b})-\Delta_{t}(\pi_{t:T}^{a},\pi_{t:T}^{b})\right| \leq \left(54.4 \sqrt{2}\kappa(\Pi_t) + 435.2 + \sqrt{2 \log \frac{1}{\delta}}\right)\sqrt{\frac{V_{t}^{\ast}}{n}} + o\left(\frac{1}{\sqrt{n}}\right),
\end{align*}
where 
    $V_{t}^{\ast}  \equiv  \sup_{\pi_{t:T}^{a},\pi_{t:T}^{b} \in \Pi_t}E \left|\left\langle \pi_{t}^{a}(H_{i,t}) - \pi_{t}(H_{i,t}),\Gamma_{i,t} \right\rangle^{2} \right|$.
\end{lemma}
\end{comment}

%\medskip{}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Proof of Lemma \ref{lem:helpful_lemma}}\label{app:proofs_of_main_lemmas}

We provide the proof of Lemma \ref{lem:helpful_lemma} in this section. 
The following lemma is a general version of Lemma \ref{lem:helpful_lemma}.

\medskip

\begin{lemma}\label{lem:helpful_lemma_general}
Fix $\pi=(\pi_1,\ldots,\pi_T)\in \Pi$. Let  $R_{t}^{\pi_{t:T}}(\tilde{\pi}_t)  \equiv  V_{t}(\tilde{\pi}_t,\pi_{(t+1):T}) - V_{t}(\pi_{t:T})$ for any $\tilde{\pi}_t \in \Pi_t$. Then, under Assumptions \ref{asm:sequential independence}, \ref{asm:overlap}, and \ref{asm:first-best}, the regret of $\pi$ is bounded from above as
\begin{align*}
    R(\pi) \leq R_{1}^{\pi_{1:T}}(\pi_{1}^{\ast,B}) + \sum_{t=2}^{T} \frac{2^{t-2}}{\eta^{t-1}} R_{t}^{\pi_{t:T}}(\pi_{t}^{\ast,B}). 
\end{align*}
\end{lemma}


\begin{proof}
For any $t$, define $R_{t}(\pi_{t:T})  \equiv  V_{t}(\pi_{t:T}^{\ast,B}) - V_{t}(\pi_{t:T})$, which is a partial regret of $\pi_{t:T}$ for stage $t$. Under Assumptions \ref{asm:overlap} and \ref{asm:first-best}, $\pi^{\ast,B}$ satisfies the condition in Assumption \ref{asm:first-best}.
For any integers $s$ and $t$ such that $1 \leq t < s \leq T$,
\begin{align}
    &V_{t}(\pi_{t}^{\ast,B},\ldots,\pi_{T}^{\ast,B}) - V_{t}(\pi_{t}^{\ast,B},\ldots,\pi_{s-1}^{\ast,B},\pi_{s},\ldots,\pi_{T}) \nonumber \\
    &= E\left[\frac{\prod_{\ell=t}^{s-1}1\{A_{\ell}=\pi_{\ell}^{\ast,B}(H_{\ell})\}}{\prod_{\ell=t}^{s-1}e_{\ell}(H_{\ell},A_{\ell})}\cdot \left(Q_{s}^{\pi_{(s+1):T}^{\ast,B}}\left(H_{s},\pi_{s}^{\ast,B}\right) - Q_{s}^{\pi_{(s+1):T}}\left(H_{s},\pi_{s}\right)\right)\right] \nonumber \\
      &\leq \frac{1}{\eta^{s-t}} E\left[\left(Q_{s}^{\pi_{(s+1):T}^{\ast,B}}\left(H_{s},\pi_{s}^{\ast,B}\right) - Q_{s}^{\pi_{(s+1):T}}\left(H_{s},\pi_{s}\right)\right)\right]  \nonumber \\
            &= \frac{1}{\eta^{s-t}} \left(V_{s}(\pi_{s:T}^{\ast,B}) - V_{s}(\pi_{s:T})\right) \nonumber \\
    &= \frac{1}{\eta^{s-t}}R_{s}\left(\pi_{t:T}\right), \label{eq:bound_delta}
\end{align}
where the first equality follows from Lemma \ref{lemma:identification} (i) and Assumption \ref{asm:sequential independence}; the inequality follows from Assumptions \ref{asm:overlap} and \ref{asm:first-best}; the second equality follows from Lemma \ref{lemma:identification} (i).

For $t=T$ and $T-1$, we have
\begin{align*}
R_{T}(\pi_T) &= V_{T}(\pi_{T}^{\ast,B}) - V_{T}(\pi_{T}) = R_{T}^{\pi_{T}}(\pi_{T}^{\ast,B});  \\
   R_{T-1}\left(\pi_{(T-1):T}\right) &= \left[V_{T-1}\left(\pi_{T-1}^{\ast,B},\pi_{T}^{\ast,B}\right) - V_{T-1}\left(\pi_{T-1}^{\ast,B},\pi_{T}\right) \right]
   + \left[V_{T-1}\left(\pi_{T-1}^{\ast,B},\pi_{T}\right) - V_{T-1}\left(\pi_{T-1},\pi_{T}\right)\right] \\
   &\leq \frac{1}{\eta}R_{T}^{\pi_{T}}(\pi_{T}^{\ast,B}) + R_{T-1}^{\pi_{(T-1):T}}\left(\pi_{T-1}^{\ast,B}\right) \\
   &= \frac{1}{\eta}R_T(\pi_{T}) + R_{T-1}^{\pi_{(T-1):T}}\left(\pi_{T-1}^{\ast,B}\right),
\end{align*}
where the inequality follows from (\ref{eq:bound_delta}).

Generally, for $k=2,\ldots,T-1$, it follows that
\begin{align*}
    &R_{T-k}\left(\pi_{(T-k):T}\right) \\
    &= V_{T-k}\left(\pi_{T-k}^{\ast,B},\ldots,\pi_{T}^{\ast,B}\right) - V_{T-k}\left(\pi_{T-k},\ldots,\pi_{T}\right) \\ &=\sum_{s=T-k}^{T}\left[V_{T-k}\left(\pi_{T-k}^{\ast,B},\ldots,\pi_{s}^{\ast,B},\pi_{s+1},\ldots,\pi_{T}\right) - V_{T-k}\left(\pi_{T-k}^{\ast,B},\ldots,\pi_{s-1}^{\ast,B},\pi_{s},\ldots,\pi_{T}\right)\right] \\
    &=\sum_{s=T-k+1}^{T}\left[V_{T-k}\left(\pi_{T-k}^{\ast,B},\ldots,\pi_{s}^{\ast,B},\pi_{s+1},\ldots,\pi_{T}\right) - V_{T-k}\left(\pi_{T-k}^{\ast,B},\ldots,\pi_{s-1}^{\ast,B},\pi_{s},\ldots,\pi_{T}\right)\right]  \\
    &+ R_{T-k}^{\pi_{(T-k):T}}(\pi_{T-k}^{\ast,B})\\
    %&\leq \sum_{s=T-k}^{T}\left[V_{T-k}\left(\pi_{T-k}^{\ast,B},\ldots,\pi_{T}^{\ast,B}\right) - V_{T-k}\left(\pi_{T-k}^{\ast,B},\ldots,\pi_{s-1}^{\ast,B},\pi_{s},\ldots,\pi_{T}\right)\right]\\
    &\leq \sum_{s=T-k+1}^{T}\left[V_{T-k}\left(\pi_{T-k}^{\ast,B},\ldots,\pi_{T}^{\ast,B}\right) - V_{T-k}\left(\pi_{T-k}^{\ast,B},\ldots,\pi_{s-1}^{\ast,B},\pi_{s},\ldots,\pi_{T}\right)\right] + R_{T-k}^{\pi_{(T-k):T}}(\pi_{T-k}^{\ast,B})\\
    &\leq \sum_{s=T-k+1}^{T}\frac{1}{\eta^{s-T+k}} R_{s}\left(\pi_{t:T}\right)+ R_{T-k}^{\pi_{(T-k):T}}(\pi_{T-k}^{\ast,B}),
\end{align*}
where the second equality follows from the telescoping sum; the third equality follows from the definition of $R_{T-k}^{\pi_{(T-k):T}}(\pi_{T-k}^{\ast,B})$; the first inequality follows from Lemma \ref{lemma:identification} and Assumption \ref{asm:first-best}; the last line follows from (\ref{eq:bound_delta}).

Then, recursively, the following hold:
\begin{align*}
    R_{T-1}\left(\pi_{(T-1):T}\right) &\leq \frac{1}{\eta}R_{T}\left(\pi_{T}\right)+ R_{T-1}^{\pi_{(T-1):T}}(\pi_{T-1}^{\ast,B}) \\
    &= \frac{1}{\eta}R_{T}^{\pi_{T}}\left(\pi_{T}^{\ast,B}\right)+ R_{T-1}^{\pi_{(T-1):T}}(\pi_{T-1}^{\ast,B}), \\
    R_{T-2}\left(\pi_{(T-2):T}\right) &\leq \frac{1}{\eta}R_{T-1}\left(\pi_{(T-1):T}\right)+
    \frac{1}{\eta^2}R_{T}\left(\pi_{T}\right)+R_{T-2}^{\pi_{(T-2):T}}(\pi_{T-2}^{\ast,B}) \\
    &\leq \frac{2}{\eta^2}R_{T}^{\pi_{T}}\left(\pi_{T}^{\ast,B}\right) + \frac{1}{\eta}R_{T-1}^{\pi_{(T-1):T}}\left(\pi_{T-1}^{\ast,B}\right) +R_{T-2}^{\pi_{(T-2):T}}(\pi_{T-2}^{\ast,B}),\\
    & \ \ \vdots \\
R_{T-k}\left(\pi_{(T-k):T}\right) & \leq \sum_{s=1}^{k} \frac{2^{k-s}}{\eta^{k-s+1}} R_{T-s+1}^{\pi_{(T-s+1):T}}(\pi_{T-s+1}^{\ast,B}) + R_{T-k}^{\pi_{(T-k):T}}(\pi_{T-k}^{\ast,B}).
\end{align*}
Therefore, setting $k=T-1$ and noting that $R_{1}\left(\pi_{1:T}\right) = R(\pi)$, we obtain
\begin{align*}
    R(\pi) &\leq  \sum_{s=1}^{T-1} \frac{2^{T-1-s}}{\eta^{T-s}} R_{T-s+1}^{\pi_{(T-s+1):T}}(\pi_{T-s+1}^{\ast,B}) + R_{1}^{\pi_{1:T}}(\pi_{1}^{\ast,B}) \\
    & = R_{1}^{\pi_{1:T}}(\pi_{1}^{\ast,B}) + \sum_{s=1}^{T-1} \frac{2^{s-1}}{\eta^{s}} R_{s+1}^{\pi_{(s+1):T}}(\pi_{s+1}^{\ast,B}).
\end{align*}
Setting $t=s+1$ in the above equation leads to the result.
\end{proof}


\medskip

The proof of Lemma \ref{lem:helpful_lemma} is given below.

\bigskip
\noindent
\textit{Proof of Lemma \ref{lem:helpful_lemma}.}
Lemma \ref{lem:helpful_lemma} follows immediately from Lemma \ref{lem:helpful_lemma_general} with setting $\pi=\hat{\pi}$.\hfill {\large $\Box$}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Proof of Lemma \ref{lem:asymptotic_estimated_policy_difference_function}}
\label{app:proof_of_main_lemma_2}

This section presents the proof of Lemma \ref{lem:asymptotic_estimated_policy_difference_function}. We here consider extending the analytical strategy of \cite{Athey_Wager_2020} and \cite{zhou2022offline}, 
which leverages orthogonal moments and cross-fitting, to the sequential multi-stage setting.

We begin by introducing several notational definitions. For any $\underline{a}_{s:t} \in \underline{\MA}_{s:t}$ and $\pi_{s:t}^{a},\pi_{s:t}^{b} \in \Pi_{s:t}$, let
\begin{align*}
    G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}  \equiv  \prod_{\ell=s}^{t}1\{\pi_{\ell}^{a}(H_{i,\ell})=a_\ell\} - \prod_{\ell=s}^{t}1\{\pi_{\ell}^{b}(H_{i,\ell})=a_\ell\}.
\end{align*} 
Given a fixed DTR $\pi=(\pi_1,\ldots,\pi_T)$, with some abuse of notation, we define
\begin{align*}
\widetilde{V}_{i,T}(a_{T}) &\equiv \frac{ Y_{i,T} - Q_{T}(H_{i,T},a_{T}) }{e_{T}(H_{i,T},a_{T})}\cdot 1\{A_{i,T}=a_{T}\} + Q_{T}(H_{i,T},a_{T}),\\
\widehat{V}_{i,T}(a_{T}) &\equiv \frac{ Y_{i,T} - \widehat{Q}_{T}^{-k(i)}(H_{i,T},a_{T}) }{\hat{e}_{T}^{-k(i)}(H_{i,T},a_{T})}\cdot 1\{A_{i,T}=a_{T}\} + \widehat{Q}_{T}^{-k(i)}(H_{i,T},a_{T}),
\end{align*}
and, recursively, for $t=T-1,\ldots,1$,
\begin{align*}
\widetilde{V}_{i,t}^{\pi_{(t+1):T}}(a_{t}) &\equiv \frac{ Y_{i,t} + \widetilde{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1})) - Q_{t}^{\pi_{(t+1):T}}(H_{i,t},a_{t}) }{e_{t}(H_{i,t},a_{t})}\cdot 1\{A_{i,t} = a_{t}\} \\
&+ Q_{t}^{\pi_{(t+1):T}}(H_{i,t},a_{t}),\\
\widehat{V}_{i,t}^{\pi_{(t+1):T}}(a_t) &\equiv \frac{ Y_{i,t} + \widehat{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1})) - \widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}(H_{i,t},a_{t}) }{\hat{e}_{t}^{-k(i)}(H_{i,t},a_{t})}\cdot 1\{A_{i,t} = a_{t}\} \\
&+ \widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}(H_{i,t},a_{t}),
\end{align*}
where, for $t=T$, we denote $\widetilde{V}_{i,T}^{\pi_{(T+1):T}}(a_{t}) = \widetilde{V}_{i,T}(a_{T})$ and $\widehat{V}_{i,T}^{\pi_{(T+1):T}}(a_{t}) = \widehat{V}_{i,T}(a_{T})$.
Note that the inside of (\ref{eq:latter}) is expressed as
\begin{align}
    &\widehat{\Delta}_{t}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T}) - \widetilde{\Delta}_{t}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T}) \nonumber \\
    &= \sum_{a_{t} \in \MA_{t}} G_{i,\pi_{t}^{a},\pi_{t}^{b}}^{a_{t}}\left(\widehat{V}_{i,t}^{\pi_{(t+1):T}}(a_t) - \widetilde{V}_{i,t}^{\pi_{(t+1):T}}(a_t)\right). \label{eq:latter_expression_1}
\end{align}

For integers $s$ and $t$ such that $1 \leq s \leq t \leq T$ and $\underline{a}_{s:t} \in \underline{\MA}_{s:t}$, let
\begin{align*}
    &\widetilde{S}_{s:t}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T}) \\
    &\equiv  \frac{1}{n}\sum_{i=1}^{n} G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\cdot \left(\frac{\prod_{\ell = s}^{t-1}1\{ A_{i,\ell} = a_{\ell}\} }{\prod_{\ell = s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell}) } \right) 
    \cdot \left(\widehat{V}_{i,t}^{\pi_{(t+1):T}}(a_t) - \widetilde{V}_{i,t}^{\pi_{(t+1):T}}(a_t)\right),
\end{align*}
where we assume that $(\prod_{\ell = s}^{t-1}1\{ A_{i,\ell} = a_{\ell}\})/(\prod_{\ell = s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})) = 1$ when $s=t$. We denote $\widetilde{S}_{t}^{a_{t}}(\pi_{t}^{a},\pi_{t}^{b},\pi_{(t+1):T}) = \widetilde{S}_{t:t}^{\underline{a}_{t:t}}(\pi_{t:t}^{a},\pi_{t:t}^{b},\pi_{(t+1):T})$ for the case $s=t$.
For $t=T$, we also denote $\widetilde{S}_{s:t}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T}) = \widetilde{S}_{s:T}^{\underline{a}_{s:T}}(\pi_{s:T}^{a},\pi_{s:T}^{b})$ where
\begin{align*}
    \widetilde{S}_{s:T}^{\underline{a}_{s:T}}(\pi_{s:T}^{a},\pi_{s:T}^{b}) \equiv \frac{1}{n}\sum_{i=1}^{n} G_{i,\pi_{s:T}^{a},\pi_{s:T}^{b}}^{\underline{a}_{s:T}}\cdot \left(\frac{\prod_{\ell = s}^{T-1}1\{ A_{i,\ell} = a_{\ell}\} }{\prod_{\ell = s}^{T-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell}) } \right) 
    \cdot \left(\widehat{V}_{i,T}(a_T) - \widetilde{V}_{i,T}(a_T)\right).
\end{align*}

Note that
\begin{align*}
\sum_{a_{t} \in \MA_{t}}\widetilde{S}_{t}^{a_{t}}(\pi_{t}^{a},\pi_{t}^{b},\pi_{(t+1):T}) =    \widehat{\Delta}_{t}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T}) - \widetilde{\Delta}_{t}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T})
\end{align*}
holds from equation (\ref{eq:latter_expression_1}).
Hence, regarding (\ref{eq:latter}), it follows that
\begin{align}
     &\sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}} \sup_{\pi_{t}^{a},\pi_{t}^{b} \in \Pi_{t}} |\widehat{\Delta}_{t}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T}) - \widetilde{\Delta}_{t}(\pi_{t}^{a},\pi_{(t+1):T};\pi_{t}^{b},\pi_{(t+1):T})| \nonumber \\
     &\leq \sum_{a_{t} \in \MA_{t}} \sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}} \sup_{\pi_{t}^{a},\pi_{t}^{b} \in \Pi_{t}} |\widetilde{S}_{t}^{a_{t}}(\pi_{t}^{a},\pi_{t}^{b},\pi_{(t+1):T})|. \label{eq:latter_bound}
\end{align}
This result enables us to evaluate (\ref{eq:latter}) through evaluating $$\sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}} \sup_{\pi_{t}^{a},\pi_{t}^{b} \in \Pi_{t}} |\widetilde{S}_{t}^{a_{t}}(\pi_{t}^{a},\pi_{t}^{b},\pi_{(t+1):T})|$$
for each $a_{t}\in \MA_{t}$.

\medskip


\begin{lemma} \label{lem:convergence_rate_Stilde}
Suppose that Assumptions \ref{asm:sequential independence}, \ref{asm:bounded outcome}, \ref{asm:overlap}, \ref{asm:rate_of_convergence_backward}, and \ref{asm:bounded entropy} hold. 
Then for any integers $s$ and $t$ such that $1\leq s \leq t < T$,
\begin{align}
        &\sup_{\pi_{(t+1):T} \in  \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| \nonumber \\
        & \leq  O_{p}(n^{-\min\{1/2,\tau/2\}}) \notag \\
        &+ \sum_{a_{t+1} \in \MA_{t+1}}\sup_{\pi_{(t+2):T} \in  \Pi_{(t+2):T}} \sup_{\pi_{s:(t+1)}^{a},\pi_{s:(t+1)}^{b}\in \Pi_{s:(t+1)}} \left| \widetilde{S}_{s:(t+1)}^{\underline{a}_{s:(t+1)}}(\pi_{s:(t+1)}^{a},\pi_{s:(t+1)}^{b},\pi_{(t+2):T})\right|. \label{eq:sequential_bound}
\end{align}
Moreover, for any integer $t$ such that $1 \leq t \leq T$,
\begin{align}
    &\sup_{\pi_{t:T}^{a},\pi_{t:T}^{a}\in \Pi_{t:T}} \left| \widetilde{S}_{t:T}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})\right| =  O_{p}(n^{-\min\{1/2,\tau/2\}}). \label{eq:final_term_convergence}
\end{align}
\end{lemma}

\medskip

\begin{proof}

We first consider the case that $t <T$. For any integers $s$ and $t$ such that $1\leq s\leq t < T$, we define
\begin{align*}
\widetilde{S}_{s:t,(A)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})& \equiv \frac{1}{n}\sum_{i=1}^{n}
G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}
\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})} \nonumber \\
&\times\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right) \nonumber\\
&\times \left(1-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right); \\
\widetilde{S}_{s:t,(B)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})& \equiv \frac{1}{n}\sum_{i=1}^{n}G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})} \nonumber \\
	&\times\left(\widetilde{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1}))-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right) \nonumber \\
 &\times \left(\frac{1\left\{ A_{i,t}=a_{t}\right\} }{\hat{e}_{t}^{-k(i)}\left(H_{i,t},a_{t}\right)}-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right);  \\
\widetilde{S}_{s:t,(C)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})& \equiv \frac{1}{n}\sum_{i=1}^{n}G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})} \nonumber \\
&\times\left(Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)\right) \notag \\ 
&\times \left(\frac{1\left\{ A_{i,t}=a_{t}\right\} }{\hat{e}_{t}^{-k(i)}\left(H_{i,t},a_{t}\right)}-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right).
\end{align*}
Using these definitions, we can decompose $\widetilde{S}_{s:t}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})$ as follows:
\begin{align*}
    &\widetilde{S}_{s:t}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T}) \\
    &= \widetilde{S}_{s:t,(A)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T}) 
    + \widetilde{S}_{s:t,(B)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})  
    + \widetilde{S}_{s:t,(C)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T}) \\
    &+ \frac{1}{n}\sum_{i=1}^{n} G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}} \left(\frac{\prod_{\ell = s}^{t}1\{ A_{i,\ell} = a_{\ell}\} }{\prod_{\ell = s}^{t}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell}) } \right) \left(\widehat{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1})) - \widetilde{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1}))\right).
\end{align*}
Regarding the forth term in the above equation, it follows that
\begin{align*}
    \sup_{\pi_{(t+1):T} \in  \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} &\left| \frac{1}{n}\sum_{i=1}^{n} G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}  \left(\frac{\prod_{\ell = s}^{t}1\{ A_{i,\ell} = a_{\ell}\} }{\prod_{\ell = s}^{t}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell}) } \right) \right.\\
    &\left. \times\left(\widehat{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1})) - \widetilde{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1}))\right)\right| \\
    \leq  \sum_{a_{t+1} \in \MA_{t+1}} &\sup_{\pi_{(t+2):T} \in  \Pi_{(t+2):T}} \sup_{\pi_{s:(t+1)}^{a},\pi_{s:(t+1)}^{b}\in \Pi_{s:(t+1)}} \left| \widetilde{S}_{s:(t+1)}^{\underline{a}_{s:(t+1)}}(\pi_{s:(t+1)}^{a},\pi_{s:(t+1)}^{b},\pi_{(t+2):T})\right|. 
\end{align*}
Hence, we have 
\begin{align}
        &\sup_{\pi_{(t+1):T} \in  \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| \nonumber \\
        & \leq  \sup_{\pi_{(t+1):T} \in  \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(A)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| \nonumber \\
        &+ \sup_{\pi_{(t+1):T} \in  \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(B)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| \nonumber \\
        &+ \sup_{\pi_{(t+1):T} \in  \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(C)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| \nonumber \\
        &+ \sum_{a_{t+1} \in \MA_{t+1}}\sup_{\pi_{(t+2):T} \in  \Pi_{(t+2):T}} \sup_{\pi_{s:(t+1)}^{a},\pi_{s:(t+1)}^{b}\in \Pi_{s:(t+1)}} \left| \widetilde{S}_{s:(t+1)}^{\underline{a}_{s:(t+1)}}(\pi_{s:(t+1)}^{a},\pi_{s:(t+1)}^{b},\pi_{(t+2):T})\right|. \label{eq:Stilde_bound}
\end{align}

In what follows, we will prove that:
\begin{align}
    \sup_{\pi_{(t+1):T} \in  \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(A)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| &= O_{P}\left(n^{-1/2}\right); \label{eq:S_tilde_A_bound}\\
    \sup_{\pi_{(t+1):T} \in  \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(B)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| &= O_{P}\left(n^{-1/2}\right); \label{eq:S_tilde_B_bound}\\
    \sup_{\pi_{(t+1):T} \in  \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(C)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| &= O_{P}\left(n^{-\min\{1/2,\tau/2\}}\right). \label{eq:S_tilde_C_bound}
\end{align}
Then we can obtain the result (\ref{eq:sequential_bound}) from equation (\ref{eq:Stilde_bound}).
%We will prove the results for the case of $s < t$. The results for the case of $s=t$ follow from the same argument. Fix $s$ and $t$, $\underline{a}_{s:T} \in \underline{\MA}_{s:T}$, and $\pi_{s:T} \in \Pi_{s:T}$. 

Throughout the proof, without loss of generality, we assume that $n>n_0$, where $n_0$ is defined in Assumption \ref{asm:rate_of_convergence_backward}.
We begin by examining $\widetilde{S}_{s:t,(A)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})$, which we decompose as follows:
\begin{align*}
    &\widetilde{S}_{s:t,(A)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T}) = \widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T}) + \widetilde{S}_{s:t,(A2)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T}),
\end{align*}
where
\begin{align*}
\widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})& \equiv \frac{1}{n}\sum_{i=1}^{n}G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\cdot\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\\
      &\times\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\left(1-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right);\\
\widetilde{S}_{s:t,(A2)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})& \equiv \frac{1}{n}\sum_{i=1}^{n}G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\cdot\left(\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})}-\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\right)\\
 &\times\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\left(1-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right).
\end{align*}
For each fold index $k$, we define
\begin{align*}
\widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})& \equiv \frac{1}{n}\sum_{i \in I_{k}}G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\cdot\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\\
      &\times\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\left(1-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right).
\end{align*}



Fix $k \in \{1,\ldots,K\}$. We now consider $\widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})$. Since $\widehat{Q}_{t}^{\pi_{(t+1):T},-k}(\cdot,a_{t})$ is computed using the data in the rest $K-1$ folds, when the data $\MS_{-k} \equiv \{Z_i : i \notin I_{k}\}$ in the rest $K-1$ folds is conditioned,  $\widehat{Q}_{t}^{\pi_{(t+1):T},-k}(\cdot,\underline{a}_{t:T})$ is fixed; hence, $\widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})$ is a sum of i.i.d. bounded random variables under Assumptions \ref{asm:bounded outcome}, \ref{asm:overlap}, and \ref{asm:rate_of_convergence_backward} (ii).

It follows that 
\begin{align*}
&E\left[G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\cdot\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\cdot\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right) \right. \\ & \left. \times \left(1-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right)\middle| \MS_{-k}\right]\\
&=	E\left[G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\cdot\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})} \cdot \left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\right. \\ 
& \left. \times E\left[\left(1-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right)\middle| H_{i,t}\right]\middle|\MS_{-k} \right]\\
&=	E\left[G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\cdot\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})} \cdot \left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\right. \\ 
& \left. \times \left(1-\frac{e_{t}\left(H_{i,t},a_{t}\right)}{e_{t}\left(H_{i,t},a_{t}\right)}\right)\middle|\MS_{-k} \right]\\
&=	0.
\end{align*}
Hence, fixing $\pi_{(t+1):T}$, $\sup_{\pi_{s:T}^{a},\pi_{s:T}^{b}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right|$ can be written as
\begin{align*}
     	&\sup_{\pi_{s:T}^{a},\pi_{s:T}^{b}\in \Pi_{s:t}}\left|\widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right|\\
&=	\frac{1}{K}\sup_{\pi_{s:T}^{a},\pi_{s:T}^{b}\in \Pi_{s:t}}\left|\frac{1}{n/K}\sum_{i \in I_k }
G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\cdot\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\right.\\
	&\times \left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\left(1-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right) \\
	&-E\left[\frac{1}{n/K}\sum_{i \in I_k }G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\cdot\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\right.\\
	&\left.\left.\times\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\left(1-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right)\middle|\MS_{-k} \right] \right|.
\end{align*}

By applying Lemma \ref{lem:concentration inequality_influence difference function} while fixing $\MS_{-k}$ and setting $i \in I_k$ and 
\begin{align*}
    \Gamma_{i}^{\dag}(\underline{a}_{s:t})= \frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\left(1-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right),
\end{align*}
the following holds: $\forall \delta > 0$, with probability at least $1-2\delta$,
\begin{align*}
&\sup_{\pi_{s:T}^{a},\pi_{s:T}^{b}\in \Pi_{s:t}}\left|\widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right|\\
&\leq	o\left(n^{-1/2}\right)+\left(54.4\kappa\left(\Pi_{s:t}\right)+435.2+\sqrt{2\log(1/\delta)}\right) \\
	&\times\left[\sup_{\pi_{s:T}\in \Pi_{s:T}}E\left[\left(G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\right)^{2}\cdot\left(\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\right)^{2}\right.\right.\\
&	\left.\left.\left.\times\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)^{2}\left(1-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right)^{2}\right|\MS_{-k} \right] \middle/ \left(\frac{n}{K}\right) \right]^{1/2} \\
&\leq	o\left(n^{-1/2}\right)+\sqrt{K} \cdot \left(54.4\kappa\left(\Pi_{s:t}\right)+435.2+\sqrt{2\log(1/\delta)}\right)
	\cdot \left(\frac{1}{\eta}\right)^{t-s+1}\\
	&\times \sqrt{\frac{E\left[\left.\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)^2\right|\MS_{-k} \right]}{n}},
\end{align*}
where the last inequality follows from $\left(G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\right)^{2}\leq 1$ a.s. and Assumption \ref{asm:overlap} (overlap condition). 
Note that $\kappa\left(\Pi_{s:t}\right)$ is finite by Lemma \ref{lem:entropy_integral_bound} and the inequality $\kappa\left(\Pi_{s:t}\right) \leq \kappa\left(\Pi \right)$.
From Assumptions \ref{asm:bounded outcome} and \ref{asm:rate_of_convergence_backward} (ii), we have 
\begin{align*}
    \sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}}E\left[\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)^2\right]<\infty.
\end{align*}
Hence, Markov's inequality yields
\begin{align*}
    \sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}} E\left[\left.\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)^2\right|\MS_{-k} \right] = O_p(1).
\end{align*}
Combining these results, we obtain
\begin{align}
    \sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}}\sup_{\pi_{s:T}^{a},\pi_{s:T}^{b}\in \Pi_{s:t}}\left|\widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| = O_p \left(\frac{1}{\sqrt{n}}\right). \label{eq:A1_convergence}
\end{align}
Consequently, 
\begin{align*}
    &\sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}}\sup_{\pi_{s:T}^{a},\pi_{s:T}^{b}\in \Pi_{s:t}}\left|\widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| \\
    &\leq  \sum_{k=1}^{K}\sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}}\sup_{\pi_{s:T}^{a},\pi_{s:T}^{b}\in \Pi_{s:t}}\left|\widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| = O_p \left(\frac{1}{\sqrt{n}}\right).
\end{align*}

We next consider $\widetilde{S}_{s:t,(B)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})$ (we will consider $\widetilde{S}_{s:t,(A2)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})$ later). We begin by decomposing $\widetilde{S}_{s:t,(B)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})$ as follows:
\begin{align*}
    \widetilde{S}_{s:t,(B)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})=\sum_{k=1}^{K}\left(\widetilde{S}_{s:t,(B1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})+\widetilde{S}_{s:t,(B2)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right),
\end{align*}
where
\begin{align*}
    \widetilde{S}_{s:t,(B1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})& \equiv \frac{1}{n}\sum_{i\in I_k}G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\left(\widetilde{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1}))-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\\
    &\times \left(\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}-\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k}(H_{i,\ell},a_{\ell})}\right)\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)};\\
    \widetilde{S}_{s:t,(B2)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})& \equiv \frac{1}{n}\sum_{i \in I_k}G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\left(\widetilde{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1}))-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\\
    &\times \left(\frac{\prod_{\ell=s}^{t}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})}-\frac{\prod_{\ell=s}^{t}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t}e_{\ell}(H_{i,\ell},a_{\ell})}\right).
\end{align*}

Fix $k \in \{1,\ldots,K\}$. As for $  \widetilde{S}_{s:t,(B1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})$, taking the conditional expectation given the date $\MS_{-k}$ in the rest $k-1$ folds leads to 
\begin{align}
&E\left[ \widetilde{S}_{s:t,(B1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\middle|\MS_{-k}\right] \nonumber \\
 	&=E\left[\frac{1}{n/K}\sum_{i \in I_k}G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\left(\widetilde{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1}))-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\right. \nonumber \\
 	&\left.\times\left(\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}-\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k}(H_{i,\ell},a_{\ell})}\right)\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\middle|\MS_{-k}\right] \nonumber \\
&=	E\left[\frac{1}{n/K}\sum_{i \in I_k}G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}E\left[\widetilde{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1}))-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\middle|H_{i,t},A_{i,t}=a_{t}\right]\right. \nonumber \\
&\left. \times \left(\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}-\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k}(H_{i,\ell},a_{\ell})}\right)\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\middle|\MS_{-k}\right] \nonumber \\
&=	E\left[\frac{1}{n/K}\sum_{i \in I_k}G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\left(Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)\right. \nonumber \\
&\left.\times \left(\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}-\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k}(H_{i,\ell},a_{\ell})}\right)\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\middle|\MS_{-k}\right] \nonumber \\
&=	0, \nonumber
\end{align}
where the third equality follows from Lemma \ref{lemma:identification} (i). Note that conditional on $\MS_{-k}$, $\widetilde{S}_{s:t,(B1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})$ is a sum of i.i.d. bounded random variables under Assumptions \ref{asm:bounded outcome}, \ref{asm:overlap}, and \ref{asm:rate_of_convergence_backward} (ii), and its condition mean is zero.
Hence, fixing $\pi_{(t+1):T}$ and conditioning on $\MS_{-k}$, we can apply Lemma \ref{lem:concentration inequality_influence difference function} with setting $i \in I_k$ and 
\begin{align*}
    \Gamma_{i}^{\dag}(\underline{a}_{s:t})&=	\left(\widetilde{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1}))-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right) \\
&\times \left(\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}-\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k}(H_{i,\ell},a_{\ell})}\right)\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}
\end{align*}
to obtain the following: $\forall \delta > 0$, with probability at least $1-2\delta$,
\begin{align*}
    	&\sup_{\pi_{s:t}^{a},\pi_{s:t}^{b}\in\Pi_{s:t}}\left|\widetilde{S}_{s:t,(B1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| \\
&\leq	o\left(n^{-1/2}\right)+\left(54.4\kappa\left(\Pi_{s:t}\right)+435.2+\sqrt{2\log(1/\delta)}\right) \\
&\times	\left[\sup_{\pi_{s:T}\in\Pi_{t:T}}E\left[\left(G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\right)^{2}\cdot\left(\widetilde{V}_{i,t+1}^{\pi_{(t+2):T}}(\pi_{t+1}(H_{i,t+1}))-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)^{2}\right.\right.\\
&\left.\left. \left(\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}-\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k}(H_{i,\ell},a_{\ell})}\right)^{2}\left(\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right)^{2}\middle| \MS_{-k} \right]\middle/ \left(\frac{n}{K}\right)\right]^{1/2} \\
&\leq	o\left(n^{-1/2}\right)+\sqrt{K}\cdot\left(54.4\kappa\left(\pi_{t:T}\right)+435.2+\sqrt{2\log(1/\delta)}\right)\cdot\left(\sum_{j=0}^{T-t}\frac{3M}{\eta^j}\right) \\
&\times	\sqrt{\frac{E\left[\left(\frac{1}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}-\frac{1}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k}(H_{i,\ell},a_{\ell})}\right)^{2}\middle|\MS_{-k} \right]}{n}},
\end{align*}
where the last inequality follows from $\left(G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\right)^{2}\leq 1$ a.s. and Assumptions \ref{asm:bounded outcome} and \ref{asm:overlap}. From Assumptions \ref{asm:overlap} and \ref{asm:rate_of_convergence_backward} (ii), we have
\begin{align*}
    E\left[\left(\frac{1}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}-\frac{1}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k}(H_{i,\ell},a_{\ell})}\right)^{2}\right] < \infty.
\end{align*}
Hence, Markov's inequality leads to
\begin{align*}
    E\left[\left(\frac{1}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}-\frac{1}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k}(H_{i,\ell},a_{\ell})}\right)^{2}\middle|\MS_{-k} \right] = O_p(1).
\end{align*}
Note also that $\kappa(\Pi_{s:t})<\infty$ by Lemma \ref{lem:entropy_integral_bound}. Combining these results, we have
\begin{align}
   \sup_{\pi_{(t+1):T}\in\Pi_{(t+1):T}}
    \sup_{\pi_{s:t}^{a},\pi_{s:t}^{b}\in\Pi_{s:t}}\left|\widetilde{S}_{s:t,(B1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| = O_p \left(\frac{1}{\sqrt{n}}\right).  \label{eq:B1_convergence}
\end{align}
By applying the same argument to derive (\ref{eq:B1_convergence}), we also obtain 
\begin{align*}
   \sup_{\pi_{(t+1):T}\in\Pi_{(t+1):T}}
    \sup_{\pi_{s:t}^{a},\pi_{s:t}^{b}\in\Pi_{s:t}}\left|\widetilde{S}_{s:t,(B2)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| = O_p \left(\frac{1}{\sqrt{n}}\right).
\end{align*}
Consequently, 
\begin{align*}
    &\sup_{\pi_{(t+1):T}\in\Pi_{(t+1):T}}
    \sup_{\pi_{s:t}^{a},\pi_{s:t}^{b}\in\Pi_{s:t}}\left|\widetilde{S}_{s:t,(B)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right|\\
    &\leq  \sum_{k=1}^{K}\sup_{\pi_{(t+1):T}\in\Pi_{(t+1):T}}
    \sup_{\pi_{s:t}^{a},\pi_{s:t}^{b}\in\Pi_{s:t}}\left|\widetilde{S}_{s:t,(B1)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right|\\ 
     &+ \sum_{k=1}^{K}\sup_{\pi_{(t+1):T}\in\Pi_{(t+1):T}}
    \sup_{\pi_{s:t}^{a},\pi_{s:t}^{b}\in\Pi_{s:t}}\left|\widetilde{S}_{s:t,(B2)}^{\underline{a}_{s:t},k}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right|\\
    &= O_p \left(\frac{1}{\sqrt{n}}\right),
\end{align*}
which proves equation (\ref{eq:S_tilde_B_bound}).

We next consider to bound $\sup_{\pi_{(t+1):T} \in  \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(C)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right|$ from above. 
It follows that 
\begin{align*}
&\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(C)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right|\\
	&=\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \frac{1}{n}\sum_{i=1}^{n}G_{i,\pi_{s:t}^{a},\pi_{s:t}^{b}}^{\underline{a}_{s:t}}\frac{\prod_{\ell=s}^{t-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})} 
\left(Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)\right) \right. \notag \\ 
&\left. \times \left(\frac{1\left\{ A_{i,t}=a_{t}\right\} }{\hat{e}_{t}^{-k(i)}\left(H_{i,t},a_{t}\right)}-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right) \right| \\
	&\leq\frac{1}{n}\sum_{i=1}^{n}\left|Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)\right| \\
 &\times \left|\frac{1}{\prod_{\ell=s}^{t}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})}-\frac{1}{e_{t}\left(H_{i,t},a_{t}\right)\cdot\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})}\right|\\
	&\leq\frac{1}{n}\sum_{i=1}^{n}\left|Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)\right| \cdot \left|\frac{1}{\prod_{\ell=s}^{t}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})}-\frac{1}{\prod_{\ell=s}^{t}e_{\ell}(H_{i,\ell},a_{\ell})}\right|\\
	&+\frac{1}{n}\sum_{i=1}^{n}\left|Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)\right| \\
 &\times \left|\frac{1}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})}-\frac{1}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\right|\left(\frac{1}{e_t(H_{i,t},a_t)}\right)\\
	&\leq\sqrt{\frac{1}{n}\sum_{i=1}^{n}\left(Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)\right)^{2}} \\
 &\times \sqrt{\frac{1}{n}\sum_{i=1}^{n}\left(\frac{1}{\prod_{\ell=s}^{t}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})}-\frac{1}{\prod_{\ell=s}^{t}e_{\ell}(H_{i,\ell},a_{\ell})}\right)^{2}}\\
	&+\left(\frac{1}{\eta}\right)\sqrt{\frac{1}{n}\sum_{i=1}^{n}\left(Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)\right)^{2}}\\ &\times \sqrt{\frac{1}{n}\sum_{i=1}^{n}\left(\frac{1}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})}-\frac{1}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\right)^{2}}
\end{align*}
where the last inequality follows from Cauchy-Schwartz inequality and Assumption \ref{asm:overlap} (overlap condition). Maximizing over $\Pi_{(t+1):T}$ and taking the expectation of both sides yields:
\begin{align*}
 & E\left[\sup_{\pi_{(t+1):T}\in \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(C)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right|\right] \\
 &\leq	E\left[\sup_{\pi_{(t+1):T}\in \Pi_{(t+1):T}}\sqrt{\frac{1}{n}\sum_{i=1}^{n}\left(Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)\right)^{2}}\right. \\
&	\left.\times\sqrt{\frac{1}{n}\sum_{i=1}^{n}\left(\frac{1}{\prod_{\ell=s}^{t}\hat{e}_{\ell}^{-k(i)}\left(H_{i,\ell},a_{\ell}\right)}-\frac{1}{\prod_{\ell=s}^{t}e_{\ell}\left(H_{i,\ell},a_{\ell}\right)}\right)^{2}}\right] \\
& + \eta^{-1}E\left[\sup_{\pi_{(t+1):T}\in \Pi_{(t+1):T}}\sqrt{\frac{1}{n}\sum_{i=1}^{n}\left(Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)\right)^{2}}\right. \\
&	\left.\times\sqrt{\frac{1}{n}\sum_{i=1}^{n}\left(\frac{1}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}\left(H_{i,\ell},a_{\ell}\right)}-\frac{1}{\prod_{\ell=s}^{t-1}e_{\ell}\left(H_{i,\ell},a_{\ell}\right)}\right)^{2}}\right] \\
 &\leq	\sqrt{\frac{1}{n}\sum_{i=1}^{n}E\left[\sup_{\pi_{(t+1):T}\in \Pi_{(t+1):T}}\left(Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)\right)^{2}\right]} \\
&	\times\sqrt{\frac{1}{n}\sum_{i=1}^{n}E\left[\left(\frac{1}{\prod_{\ell=s}^{t}\hat{e}_{\ell}^{-k(i)}\left(H_{i,\ell},a_{\ell}\right)}-\frac{1}{\prod_{\ell=s}^{t}e_{\ell}\left(H_{i,\ell},a_{\ell}\right)}\right)^{2}\right]} \\
&+ \eta^{-1}\sqrt{\frac{1}{n}\sum_{i=1}^{n}E\left[\sup_{\pi_{(t+1):T}\in \Pi_{(t+1):T}}\left(Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)\right)^{2}\right]} \\
&	\times\sqrt{\frac{1}{n}\sum_{i=1}^{n}E\left[\left(\frac{1}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}\left(H_{i,\ell},a_{\ell}\right)}-\frac{1}{\prod_{\ell=s}^{t-1}e_{\ell}\left(H_{i,\ell},a_{\ell}\right)}\right)^{2}\right]} \\
&= \sum_{k=1}^{K}	\sqrt{E\left[\sup_{\pi_{(t+1):T}\in \Pi_{(t+1):T}}\left(Q_{t}^{\pi_{(t+1):T}}\left(H_{t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{i,t},a_{t}\right)\right)^{2}\right]} \\
&	\times\sqrt{E\left[\left(\frac{1}{\prod_{\ell=s}^{t}\hat{e}_{\ell}^{-k}\left(H_{\ell},a_{\ell}\right)}-\frac{1}{\prod_{\ell=s}^{t}e_{\ell}\left(H_{\ell},a_{\ell}\right)}\right)^{2}\right]} \\
&+ \eta^{-1}\sum_{k=1}^{K}\sqrt{E\left[\sup_{\pi_{(t+1):T}\in \Pi_{(t+1):T}}\left(Q_{t}^{\pi_{(t+1):T}}\left(H_{t},a_{t}\right)-\widehat{Q}_{t}^{\pi_{(t+1):T},-k}\left(H_{t},a_{t}\right)\right)^{2}\right]} \\
&	\times\sqrt{E\left[\left(\frac{1}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}\left(H_{\ell},a_{\ell}\right)}-\frac{1}{\prod_{\ell=s}^{t-1}e_{\ell}\left(H_{\ell},a_{\ell}\right)}\right)^{2}\right]} \\
 &=	O\left(n^{-\tau/2}\right),
\end{align*}
where the second inequality follows from Cauchy-Schwartz inequality and the last line follows from Assumption \ref{asm:rate_of_convergence_backward} (i). Then applying Markov's inequality leads to
\begin{align}
   \sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(C)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| &= O_{P}\left(n^{-\tau/2}\right), \label{eq:S_C_convergence}
\end{align}
which proves equation (\ref{eq:S_tilde_C_bound}).

Now let us consider $\widetilde{S}_{s:t,(A2)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})$. Note that 
\begin{align*}
    	&\sup_{\pi_{(t+1):T}\in \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}}\left|\widetilde{S}_{s:t,(A2)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right|\\
    	&\leq\sup_{\pi_{(t+1):T}\in \Pi_{(t+1):T}}\frac{1}{n}\sum_{i=1}^{n}\left|\frac{1}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})}-\frac{1}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\right|\\
     &\times\left|\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right|
    	\cdot \left|1-\frac{1\left\{ A_{i,t}=a_{t}\right\} }{e_{t}\left(H_{i,t},a_{t}\right)}\right|\\
	&\leq\left(\frac{1}{\eta}\right)\sqrt{\frac{1}{n}\sum_{i=1}^{n}\left(\frac{1}{\prod_{\ell=s}^{t-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})}-\frac{1}{\prod_{\ell=s}^{t-1}e_{\ell}(H_{i,\ell},a_{\ell})}\right)^{2}}\\
	&\times \sqrt{\frac{1}{n}\sum_{i=1}^{n}\sup_{\pi_{(t+1):T}\in \Pi_{(t+1):T}}\left(\widehat{Q}_{t}^{\pi_{(t+1):T},-k(i)}\left(H_{i,t},a_{t}\right)-Q_{t}^{\pi_{(t+1):T}}\left(H_{i,t},a_{t}\right)\right)^{2}},
\end{align*}
where the last inequality follows from Assumption \ref{asm:overlap} (overlap condition) and Cauchy-Schwartz inequality. Then, by applying the same argument to derive (\ref{eq:S_C_convergence}), we obtain
\begin{align*}
    \sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(A2)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| &= O_{P}\left(n^{-\tau/2}\right).
\end{align*}
 Combining this result with (\ref{eq:A1_convergence}) leads to: 
 \begin{align*}
     &\sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}}\sup_{\pi_{s:t}^{a},\pi_{s:t}^{a}\in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(A)}^{\underline{a}_{s:t}}(\pi_{s:t}^{a},\pi_{s:t}^{b},\pi_{(t+1):T})\right| \\
     &\leq \sum_{k=1}^{K} \sup_{\pi_{s:t}^a , \pi_{s:t}^b \in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(A1)}^{\underline{a}_{s:t},k}\left(\pi_{s:t}\right)\right| 
     + \sup_{\pi_{s:t}^a , \pi_{s:t}^b \in \Pi_{s:t}} \left| \widetilde{S}_{s:t,(A2)}^{\underline{a}_{s:t}}\left(\pi_{s:t}\right)\right| \\
     &= O_{P}\left(n^{-\min\{1/2,\tau/2\}}\right).
 \end{align*}
 This result proves equation (\ref{eq:S_tilde_A_bound}). 

Consequently, combining equations (\ref{eq:Stilde_bound})--(\ref{eq:S_tilde_C_bound}), we obtain the result (\ref{eq:sequential_bound}).


We next consider the case that $t=T$. In this case, $\widetilde{S}_{t:T}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})$ is decomposed as
\begin{align*}
    &\widetilde{S}_{t:T}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b}) = \widetilde{S}_{t:T,(A)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b}) 
    + \widetilde{S}_{t:T,(B)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})  
    + \widetilde{S}_{t:T,(C)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b}),
\end{align*}
where 
\begin{align*}
\widetilde{S}_{t:T,(A)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})& \equiv \frac{1}{n}\sum_{i=1}^{n}
G_{i,\pi_{t:T}^{a},\pi_{t:T}^{b}}^{\underline{a}_{t:T}}
\frac{\prod_{\ell=s}^{T-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{T-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})} \nonumber \\
&\times\left(\widehat{Q}_{T}^{-k(i)}\left(H_{i,T},a_{T}\right)-Q_{T}\left(H_{i,T},a_{T}\right)\right) \left(1-\frac{1\left\{ A_{i,T}=a_{T}\right\} }{e_{T}\left(H_{i,T},a_{T}\right)}\right); \ \\
\widetilde{S}_{t:T,(B)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})& \equiv \frac{1}{n}\sum_{i=1}^{n}G_{i,\pi_{t:T}^{a},\pi_{t:T}^{b}}^{\underline{a}_{t:T}}\frac{\prod_{\ell=s}^{T-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{T-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})} \nonumber \\
	&\times\left(Y_{i,T}-Q_{T}\left(H_{i,T},a_{T}\right)\right)  \left(\frac{1\left\{ A_{i,T}=a_{T}\right\} }{\hat{e}_{T}^{-k(i)}\left(H_{i,T},a_{T}\right)}-\frac{1\left\{ A_{i,T}=a_{T}\right\} }{e_{T}\left(H_{i,T},a_{T}\right)}\right);  \\
\widetilde{S}_{t:T,(C)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})& \equiv \frac{1}{n}\sum_{i=1}^{n}G_{i,\pi_{t:T}^{a},\pi_{t:T}^{b}}^{\underline{a}_{t:T}}\frac{\prod_{\ell=s}^{T-1}1\{A_{i,\ell}=a_{\ell}\}}{\prod_{\ell=s}^{T-1}\hat{e}_{\ell}^{-k(i)}(H_{i,\ell},a_{\ell})} \nonumber \\
&\times\left(Q_{T}\left(H_{i,T},a_{T}\right)-\widehat{Q}_{T}^{-k(i)}\left(H_{i,T},a_{T}\right)\right) 
\left(\frac{1\left\{ A_{i,T}=a_{T}\right\} }{\hat{e}_{T}^{-k(i)}\left(H_{i,T},a_{T}\right)}-\frac{1\left\{ A_{i,T}=a_{T}\right\} }{e_{T}\left(H_{i,T},a_{T}\right)}\right).
\end{align*}
The same arguments to derive the results (\ref{eq:S_tilde_A_bound})--(\ref{eq:S_tilde_C_bound}) also show that
\begin{align*}
    \sup_{\pi_{t:T}^{a},\pi_{t:T}^{a}\in \Pi_{t:T}} \left| \widetilde{S}_{t:T,(A)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})\right| &= O_{P}\left(n^{-1/2}\right); \\
    \sup_{\pi_{t:T}^{a},\pi_{t:T}^{a}\in \Pi_{t:T}} \left| \widetilde{S}_{t:T,(B)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})\right| &= O_{P}\left(n^{-1/2}\right); \\
    \sup_{\pi_{t:T}^{a},\pi_{t:T}^{a}\in \Pi_{t:T}} \left| \widetilde{S}_{t:T,(C)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})\right| &= O_{P}\left(n^{-\min\{1/2,\tau/2\}}\right). 
\end{align*}
Therefore, 
\begin{align*}
    &\sup_{\pi_{t:T}^{a},\pi_{t:T}^{a}\in \Pi_{t:T}} \left| \widetilde{S}_{t:T}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})\right| \\
    &\leq \sup_{\pi_{t:T}^{a},\pi_{t:T}^{a}\in \Pi_{t:T}} \left| \widetilde{S}_{t:T,(A)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})\right| 
    + \sup_{\pi_{t:T}^{a},\pi_{t:T}^{a}\in \Pi_{t:T}} \left| \widetilde{S}_{t:T,(B)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})\right| \\
    &+ \sup_{\pi_{t:T}^{a},\pi_{t:T}^{a}\in \Pi_{t:T}} \left| \widetilde{S}_{t:T,(C)}^{\underline{a}_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})\right| \\
    &= O_{P}\left(n^{-\min\{1/2,\tau/2\}}\right), 
\end{align*}
which leads to the result (\ref{eq:final_term_convergence}).
\end{proof}

\medskip

We finally presents the proof of Lemma \ref{lem:asymptotic_estimated_policy_difference_function}.
\bigskip

\noindent
\textit{Proof of  Lemma \ref{lem:asymptotic_estimated_policy_difference_function}.}
From equation (\ref{eq:latter_bound}), it suffices to show that 
\begin{align}
    \sum_{a_{t} \in \MA_{t}} \sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}} \sup_{\pi_{t}^{a},\pi_{t}^{b} \in \Pi_{t}} |\widetilde{S}_{t}^{a_{t}}(\pi_{t}^{a},\pi_{t}^{b},\pi_{(t+1):T})| = O_{P}\left(n^{-\min\{1/2,\tau/2\}}\right). \label{eq:S_tilde_t_convergence}
\end{align}
Applying the result (\ref{eq:sequential_bound}) in Lemma \ref{lem:convergence_rate_Stilde} sequentially to the left-hand side of the above equation leads to
\begin{align*}
    \sum_{a_{t} \in \MA_{t}}\sup_{\pi_{(t+1):T} \in \Pi_{(t+1):T}} \sup_{\pi_{t}^{a},\pi_{t}^{b} \in \Pi_{t}} |\widetilde{S}_{t}^{a_{t}}(\pi_{t}^{a},\pi_{t}^{b},\pi_{(t+1):T})| &\leq O_{P}\left(n^{-\min\{1/2,\tau/2\}}\right) \\
    &+ \sum_{\underline{a}_{t:T} \in \underline{\MA}_{t:T}}\sup_{\pi_{t:T}^{a},\pi_{t:T}^{b} \in \Pi_{t:T}} |\widetilde{S}_{t:T}^{a_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})|.
\end{align*}
The result (\ref{eq:final_term_convergence}) in Lemma \ref{lem:convergence_rate_Stilde} shows that $$\sup_{\pi_{t:T}^{a},\pi_{t:T}^{b} \in \Pi_{t:T}} |\widetilde{S}_{t:T}^{a_{t:T}}(\pi_{t:T}^{a},\pi_{t:T}^{b})| = O_{P}\left(n^{-\min\{1/2,\tau/2\}}\right).$$
Combining these results leads to the result (\ref{eq:S_tilde_t_convergence}), which ultimately proves the result in Lemma \ref{lem:asymptotic_estimated_policy_difference_function}.
\hfill {\large $\Box$}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{equation}{0}
\renewcommand{\theequation}{C.\arabic{equation}}

\section{Proof of Theorem \ref{thm:theorem_simlutaneous}}
\label{app:statistical_property_AIPW}

This section presents  the proof of Theorem \ref{thm:theorem_simlutaneous}.

\medskip

\noindent
\textit{Proof of Theorem \ref{thm:theorem_simlutaneous}.}
We begin by noting that the objective function $\widehat{W}^{AIPW}(\pi)$ can be expressed as $\widehat{W}^{AIPW}(\pi) = (1/n)\sum_{i=1}^{n}\widehat{V}_{i,1}(\pi)$, where $\widehat{V}_{i,1}(\cdot)$ is defined in Appendix \ref{app:main_proof}. A standard argument from statistical learning theory \cite[e.g.,][]{Lugosi_2002} leads to
\begin{align}
    R(\hat{\pi}^{AIPW})  &=\Delta_{1}\left(\pi^{\ast,opt};\hat{\pi}^{AIPW}\right) 
    \nonumber\\
    &\leq \Delta_{1}\left(\pi^{\ast,opt};\hat{\pi}^{AIPW}\right) - \widehat{\Delta}_{1}\left(\pi^{\ast,opt};\hat{\pi}^{AIPW}\right) \nonumber \\
    &\leq 
    \sup_{\pi^{a},\pi^{b} \in \Pi} |\Delta_{1}(\pi^{a};\pi^{b}) - \widehat{\Delta}_{1}(\pi^{a};\pi^{b})| \nonumber \\
    & \leq   \sup_{\pi^{a},\pi^{b} \in \Pi}|\Delta_{1}(\pi^{a};\pi^{b}) - \widetilde{\Delta}_{1}(\pi^{a};\pi^{b})| 
       + \sup_{\pi^{a},\pi^{b} \in \Pi} |\widehat{\Delta}_{1}(\pi^{a};\pi^{b}) - \widetilde{\Delta}_{1}(\pi^{a};\pi^{b})|, \label{eq:basic_bound_AIPW}
\end{align}
where the first inequality follows because $\hat{\pi}^{AIPW}$ maximizes $(1/n)\sum_{i=1}^{n}\widehat{V}_{i,1}(\pi)$ over $\Pi$; hence, $\widehat{\Delta}_{1}\left(\pi^{\ast,opt};\hat{\pi}^{AIPW}\right) \leq 0$.

Regarding $\sup_{\pi^{a},\pi^{b} \in \Pi}|\Delta_{1}(\pi^{a};\pi^{b}) - \widetilde{\Delta}_{1}(\pi^{a};\pi^{b})|$, under Assumptions \ref{asm:bounded outcome}, \ref{asm:overlap}, and the result in Lemma \ref{lem:entropy_integral_bound}, we can apply Lemma \ref{lem:concentration inequality_influence difference function} to obtain the following result: 
For any $\delta \in (0,1)$, with probability at least $1-2\delta$,
\begin{align}
    \sup_{\pi^{a},\pi^{b} \in \Pi} 
  |\widetilde{\Delta}_{1}(\pi^{a};\pi^{b})  - \Delta_{1}(\pi^{a};\pi^{b})| 
    &\leq \left(54.4 \sqrt{2}\kappa(\Pi) + 435.2 + \sqrt{2 \log \frac{1}{\delta}}\right)\sqrt{\frac{V^{\ast}}{n}} \nonumber \\
    &+ o\left(\frac{1}{\sqrt{n}}\right), \label{eq:bound_influence_difference_function_AIPW}
\end{align}
where $V^{\ast}  \equiv  \sup_{\pi^{a},\pi^{b} \in \Pi}E
    \left[\left(\widetilde{\Gamma}_{i,1}^{\pi_{2:T}^{a}}(\pi^{a}) - \widetilde{\Gamma}_{i,1}^{\pi_{2:T}}(\pi^{b}) \right)^2\right] < \infty$.

Regarding $\sup_{\pi^{a},\pi^{b} \in \Pi} |\widehat{\Delta}_{1}(\pi^{a};\pi^{b}) - \widetilde{\Delta}_{1}(\pi^{a};\pi^{b})|$, we have
\begin{align*}
    \widehat{\Delta}_{1}(\pi^{a};\pi^{b}) - \widetilde{\Delta}_{1}(\pi^{a};\pi^{b}) = \sum_{\underline{a}_{T} \in \underline{\MA}_{T}} \widetilde{S}_{1:T}^{\underline{a}_{T}}(\pi^{a},\pi^{b}).
\end{align*}
Applying the result (\ref{eq:final_term_convergence}) in Lemma \ref{lem:convergence_rate_Stilde} to $\widetilde{S}_{1:T}^{\underline{a}_{T}}(\pi^{a},\pi^{b})$ for each $\underline{a}_{T}$ gives
\begin{align}
  \sup_{\pi^{a},\pi^{b} \in \Pi} |\widehat{\Delta}_{1}(\pi^{a};\pi^{b}) - \widetilde{\Delta}_{1}(\pi^{a};\pi^{b})|  =  O_{p}\left(n^{-\min\{1/2,\tau/2\}}\right). \label{eq:convergence_latter_AIPW}
\end{align}
Combining the results (\ref{eq:basic_bound_AIPW})-(\ref{eq:convergence_latter_AIPW}) leads to the result  (\ref{eq:theorem_result_AIPW}).
\hfill {\large $\Box$}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\medskip